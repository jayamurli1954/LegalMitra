<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LegalMitra - AI Legal Assistant</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="AI-powered Indian legal assistant for CA, Corporate, and Legal professionals">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/Icon_192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icons/Icon_512.png">
    <link rel="apple-touch-icon" href="/icons/Icon_192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 100%;
            max-width: 100%;
            margin: 0;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 35px 40px;
            text-align: center;
            width: 100%;
        }

        .header h1 {
            font-size: 2.8em;
            margin-bottom: 12px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px 40px;
            max-width: 100%;
        }

        /* 2-Column Layout for Legal Research Tab */
        .research-layout {
            display: flex;
            gap: 40px;
            margin-top: 20px;
            width: 100%;
            max-width: 100%;
        }

        .research-left {
            flex: 0 0 420px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            min-width: 380px;
        }

        .research-right {
            flex: 1;
            min-width: 500px;
            max-width: 100%;
        }

        .info-box {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 18px;
            font-size: 1.35em;
            padding-bottom: 12px;
            border-bottom: 2px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .refresh-btn:hover {
            background: #5568d3 !important;
        }

        .refresh-btn:active {
            background: #4457b8 !important;
            transform: scale(0.98);
        }

        .info-box ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .info-box li {
            padding: 16px;
            margin-bottom: 12px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .info-box li:hover {
            background: #e8eaf6;
            border-left-color: #764ba2;
            transform: translateX(5px);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .case-item-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            font-size: 1.05em;
        }

        .case-item-court {
            font-size: 0.95em;
            color: #666;
            margin-bottom: 6px;
        }

        .case-item-summary {
            font-size: 1em;
            color: #555;
            line-height: 1.5;
        }

        .news-item-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            font-size: 1.05em;
        }

        .news-item-meta {
            font-size: 0.9em;
            color: #888;
            margin-bottom: 6px;
        }

        .news-item-summary {
            font-size: 1em;
            color: #555;
            line-height: 1.5;
        }

        .loading-box {
            text-align: center;
            padding: 20px;
            color: #999;
        }

        /* Make responsive */
        @media (max-width: 1200px) {
            .research-layout {
                gap: 30px;
            }

            .research-left {
                flex: 0 0 380px;
                min-width: 350px;
            }
        }

        @media (max-width: 992px) {
            .research-layout {
                flex-direction: column;
            }

            .research-left {
                flex: 1;
                min-width: auto;
            }

            .research-right {
                min-width: auto;
            }
        }

        /* Mobile Responsive Header and Content */
        @media (max-width: 768px) {
            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 2em;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 1em;
            }

            .content {
                padding: 20px 15px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 1.6em;
                margin-bottom: 5px;
            }

            .header p {
                font-size: 0.9em;
            }

            .content {
                padding: 15px 10px;
            }
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }

        .tabs::-webkit-scrollbar {
            height: 4px;
        }

        .tabs::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .tabs::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 2px;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1.1em;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 700;
        }

        .tab:hover {
            color: #667eea;
        }

        /* Mobile Responsive Styles for Tabs */
        @media (max-width: 768px) {
            .tabs {
                justify-content: flex-start;
                gap: 5px;
                padding: 0 10px;
                margin-bottom: 20px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                padding: 12px 15px;
                font-size: 0.9em;
                min-width: auto;
            }
        }

        @media (max-width: 480px) {
            .tabs {
                gap: 3px;
                padding: 0 5px;
            }

            .tab {
                padding: 10px 12px;
                font-size: 0.85em;
            }

            /* Make Advocate Diary button more compact on very small screens */
            .tab:last-child {
                padding: 10px 10px;
                font-size: 0.8em;
            }
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        textarea,
        input[type="text"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        textarea:focus,
        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 160px;
            resize: vertical;
            line-height: 1.6;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .response {
            margin-top: 30px;
            padding: 25px;
            background: #f5f5f5;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .response h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .response-content {
            white-space: pre-wrap;
            line-height: 1.6;
            color: #555;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error {
            background: #fee;
            border-left-color: #e74c3c;
            color: #c0392b;
        }

        .success {
            background: #efe;
            border-left-color: #27ae60;
        }

        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .welcome-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .welcome-message h2 {
            font-size: 2em;
            margin-bottom: 15px;
            color: white;
        }

        .welcome-message p {
            font-size: 1.1em;
            margin-bottom: 10px;
            line-height: 1.6;
            opacity: 0.95;
        }

        .welcome-message p:last-of-type {
            margin-bottom: 20px;
        }

        .close-welcome {
            background: white;
            color: #667eea;
            padding: 10px 25px;
            font-size: 0.95em;
            margin-top: 10px;
        }

        .close-welcome:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        /* Footer Styles */
        .footer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 35px 50px;
            margin-top: 50px;
            text-align: center;
            width: 100%;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .footer-link {
            color: white;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .footer-link:hover {
            background: rgba(255, 255, 255, 0.2);
            text-decoration: underline;
        }

        .footer-copyright {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            opacity: 0.9;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            overflow: auto;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: none;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 20px;
        }

        .close:hover,
        .close:focus {
            color: #000;
        }

        .modal-content h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .modal-content h3 {
            color: #764ba2;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        .modal-content p,
        .modal-content li {
            line-height: 1.8;
            color: #555;
            margin-bottom: 15px;
        }

        .modal-content ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        /* Article Modal Styles */
        .article-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            overflow: auto;
        }

        .article-modal.show {
            display: block;
        }

        .article-modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 40px;
            border: none;
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .article-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #667eea;
        }

        .article-modal-title {
            color: #667eea;
            font-size: 1.8em;
            margin: 0;
            flex: 1;
        }

        .article-close {
            color: #aaa;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
            padding: 0 15px;
            transition: color 0.3s;
        }

        .article-close:hover,
        .article-close:focus {
            color: #000;
        }

        .article-body {
            line-height: 1.8;
            color: #333;
            font-size: 1.05em;
        }

        .article-loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .article-back-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 30px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        .article-back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>‚öñÔ∏è LegalMitra</h1>
            <p>AI-Powered Legal Assistant for Indian Legal System</p>
        </div>

        <div class="content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('research')">Legal Research</button>
                <button class="tab" onclick="switchTab('drafting')">Document Drafting</button>
                <button class="tab" onclick="switchTab('case-search')">Case Search</button>
                <button class="tab" onclick="switchTab('statute')">Statute Search</button>
                <button class="tab" onclick="window.location.href='diary.html'"
                    style="border-bottom-color: #764ba2; color: #764ba2;">üìö Advocate Diary</button>
            </div>

            <!-- NEW FEATURES - Quick Access Bar -->
            <div style="background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); padding: 15px; text-align: center; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                <div style="color: white; font-weight: bold; margin-bottom: 10px; font-size: 1.1em;">‚ú® NEW FEATURES - Quick Access</div>
                <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                    <button id="template-marketplace-btn" onclick="window.location.href='template-marketplace.html'" style="background: white; color: #56ab2f; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1em; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        üõí Template Marketplace (110+)
                    </button>
                    <button onclick="window.location.href='cost-dashboard.html'" style="background: white; color: #56ab2f; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1em; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        üí∞ Cost Dashboard
                    </button>
                    <button onclick="window.location.href='model-selector.html'" style="background: white; color: #56ab2f; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1em; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        ü§ñ AI Models
                    </button>
                </div>
            </div>

            <!-- Legal Research Tab -->
            <div id="research" class="tab-content active">
                <div class="welcome-message" id="welcome-message">
                    <h2>üôè Namaste! I am your LegalMitra</h2>
                    <p>Your AI-powered legal assistant for the Indian legal system. I'm here to help you with legal
                        research, document drafting, case law searches, and statute lookups.</p>
                    <p><strong>How can I assist you today?</strong></p>
                    <button onclick="document.getElementById('welcome-message').style.display='none'"
                        class="close-welcome">Got it!</button>
                </div>

                <div class="research-layout">
                    <!-- Left Sidebar: Major Cases and Latest Legal News -->
                    <div class="research-left">
                        <!-- Major Cases Box -->
                        <div class="info-box">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 12px; border-bottom: 2px solid #667eea;">
                                <h3 style="margin: 0; padding: 0; border: none;">‚öñÔ∏è Recent Major Judgments<br><span
                                        style="font-size: 0.7em; font-weight: normal; color: #666;">Supreme Court / High
                                        Court</span></h3>
                                <button id="refresh-cases-btn" class="refresh-btn" title="Refresh cases"
                                    onclick="refreshCasesAndNews()"
                                    style="background: #667eea; color: white; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-size: 0.9em; transition: background 0.3s;">
                                    üîÑ Refresh
                                </button>
                            </div>
                            <div id="major-cases-container">
                                <div class="loading-box">
                                    <div class="spinner"
                                        style="width: 30px; height: 30px; border-width: 2px; margin: 0 auto 10px;">
                                    </div>
                                    Loading recent judgments...
                                </div>
                            </div>
                        </div>

                        <!-- Latest Legal News Box -->
                        <div class="info-box">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; padding-bottom: 12px; border-bottom: 2px solid #667eea;">
                                <h3 style="margin: 0; padding: 0; border: none;">üì∞ Latest Legal News</h3>
                                <button id="refresh-news-btn" class="refresh-btn" title="Refresh news"
                                    onclick="refreshCasesAndNews()"
                                    style="background: #667eea; color: white; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-size: 0.9em; transition: background 0.3s;">
                                    üîÑ Refresh
                                </button>
                            </div>
                            <div id="legal-news-container">
                                <div class="loading-box">
                                    <div class="spinner"
                                        style="width: 30px; height: 30px; border-width: 2px; margin: 0 auto 10px;">
                                    </div>
                                    Loading legal news...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Side: Chat/Query Box -->
                    <div class="research-right">
                        <div class="info">
                            <strong>üí° Tip:</strong> Ask any legal question about Indian laws, regulations, compliance,
                            or case laws. Click on any case or news item above to learn more.
                        </div>
                        <div class="form-group">
                            <label for="research-query">Your Legal Question:</label>
                            <div style="position: relative;">
                                <textarea id="research-query" placeholder="Enter your legal question here..."
                                    style="padding-right: 100px;"></textarea>
                                <input type="file" id="research-file-input"
                                    accept=".pdf,.doc,.docx,.png,.jpeg,.jpg,.txt" style="display: none;"
                                    onchange="handleFileSelect(event)">
                                <button type="button" onclick="document.getElementById('research-file-input').click()"
                                    style="position: absolute; right: 10px; bottom: 10px; background: #667eea; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 14px; z-index: 10;"
                                    title="Upload Document/Image">üìé Upload</button>
                            </div>
                            <div id="file-preview-container"
                                style="margin-top: 10px; display: none; padding: 10px; background: #f5f5f5; border-radius: 5px; border: 1px solid #ddd;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="query-type">Query Type:</label>
                            <select id="query-type">
                                <option value="research">Research</option>
                                <option value="opinion">Legal Opinion</option>
                                <option value="case_prep">Case Preparation</option>
                            </select>
                        </div>
                        <button onclick="performResearch()">üîç Research</button>

                        <!-- Recent Queries Section -->
                        <div class="recent-queries-container" style="margin-top: 25px;">
                            <h3 class="recent-queries-toggle" onclick="toggleRecentQueries()"
                                style="cursor: pointer; color: #667eea; font-size: 1.1em; margin-bottom: 15px; padding: 10px; background: #f5f5f5; border-radius: 8px; display: flex; align-items: center; justify-content: space-between;">
                                <span>üìú Recent Queries</span>
                                <span id="toggle-icon" style="font-size: 0.9em;">‚ñº</span>
                            </h3>
                            <div id="recent-queries-list" class="recent-queries-list"
                                style="display: none; max-height: 300px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px; padding: 10px; background: #fafafa;">
                                <!-- Recent queries will be loaded here by JavaScript -->
                            </div>
                        </div>

                        <!-- Response container - MUST be after Recent Queries -->
                        <div id="research-response" style="margin-top: 25px; min-height: 50px;"></div>
                    </div>
                </div>
            </div>

            <!-- Document Drafting Tab -->
            <div id="drafting" class="tab-content">
                <div class="info">
                    <strong>üí° Tip:</strong> Provide facts and details to draft legal documents like notices, petitions,
                    or replies.
                </div>
                <div class="form-group">
                    <label for="doc-type">Document Type:</label>
                    <select id="doc-type">
                        <option value="legal notice">Legal Notice</option>
                        <option value="petition">Petition</option>
                        <option value="reply">Reply to Notice</option>
                        <option value="opinion">Legal Opinion</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="facts">Facts:</label>
                    <textarea id="facts" placeholder="Describe the facts of the case..."></textarea>
                </div>
                <div class="form-group">
                    <label for="parties">Parties (JSON format):</label>
                    <textarea id="parties" placeholder='{"sender": "ABC Company", "recipient": "XYZ Ltd"}'></textarea>
                </div>
                <div class="form-group">
                    <label for="grounds">Legal Grounds (one per line):</label>
                    <textarea id="grounds" placeholder="Breach of contract&#10;Recovery of dues"></textarea>
                </div>
                <div class="form-group">
                    <label for="prayer">Prayer/Relief Sought:</label>
                    <textarea id="prayer" placeholder="Payment of Rs. 10 lakhs within 15 days"></textarea>
                </div>
                <button onclick="draftDocument()">üìù Draft Document</button>
                <div id="drafting-response"></div>
            </div>

            <!-- Case Search Tab -->
            <div id="case-search" class="tab-content">
                <div class="info">
                    <strong>üí° Tip:</strong> Search for relevant case laws by topic, court, or year.
                </div>
                <div class="form-group">
                    <label for="case-query">Search Query:</label>
                    <textarea id="case-query" placeholder="e.g., arbitration clause interpretation"></textarea>
                </div>
                <div class="form-group">
                    <label for="court">Court (Optional):</label>
                    <input type="text" id="court" placeholder="Supreme Court, High Court, etc.">
                </div>
                <div class="form-group">
                    <label for="year">Year (Optional):</label>
                    <input type="text" id="year" placeholder="2023">
                </div>
                <button onclick="searchCases()">üîé Search Cases</button>
                <div id="case-response"></div>
            </div>

            <!-- Statute Search Tab -->
            <div id="statute" class="tab-content">
                <div class="info">
                    <strong>üí° Tip:</strong> Search for specific acts and sections of Indian laws.
                </div>
                <div class="form-group">
                    <label for="act-name">Act Name:</label>
                    <input type="text" id="act-name" placeholder="e.g., CGST Act 2017">
                </div>
                <div class="form-group">
                    <label for="section">Section Number (Optional):</label>
                    <input type="text" id="section" placeholder="e.g., 16">
                </div>
                <button onclick="searchStatute()">üìö Search Statute</button>
                <div id="statute-response"></div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-links">
                <a href="#" class="footer-link" onclick="openModal('disclaimer'); return false;">Disclaimer</a>
                <a href="#" class="footer-link" onclick="openModal('privacy'); return false;">Privacy Policy</a>
                <a href="#" class="footer-link" onclick="openModal('terms'); return false;">Terms of Use</a>
                <a href="#" class="footer-link" onclick="openModal('about'); return false;">About</a>
                <a href="#" class="footer-link" onclick="openModal('contact'); return false;">Contact</a>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2025 LegalMitra. All rights reserved. | AI-Powered Legal Assistant for Indian Legal System</p>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Disclaimer Modal -->
    <div id="disclaimer-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('disclaimer')">&times;</span>
            <h2>Disclaimer</h2>
            <div>
                <h3>1. General Information</h3>
                <p>LegalMitra is an AI-powered legal assistant designed to provide legal information and assistance for
                    Indian laws. This service is intended for informational and educational purposes only.</p>
                <h3>2. Not Legal Advice</h3>
                <p>The information, documents, and responses provided by LegalMitra do not constitute legal advice,
                    legal representation, or the formation of an attorney-client relationship. LegalMitra is not a
                    substitute for professional legal counsel from a qualified advocate or attorney.</p>
                <p><strong>You should always consult a qualified legal professional for:</strong></p>
                <ul>
                    <li>Matters requiring court representation</li>
                    <li>Specific advice for your unique circumstances</li>
                    <li>Document review and filing</li>
                    <li>Legal strategy and case preparation</li>
                </ul>
                <h3>3. Accuracy and Completeness</h3>
                <p>While we strive to provide accurate and up-to-date legal information based on Indian laws and
                    regulations:</p>
                <ul>
                    <li>Laws and regulations are subject to frequent changes through amendments, notifications, and
                        judicial pronouncements</li>
                    <li>Case law interpretations may vary between courts and over time</li>
                    <li>State-specific laws may differ from central legislation</li>
                    <li>Information is current as of [Last Update Date] and may not reflect recent changes</li>
                    <li><strong>Users must independently verify all citations, statutes, and case laws before relying on
                            them</strong></li>
                </ul>
                <h3>4. Case Law and Citations</h3>
                <p>LegalMitra provides case law citations and legal precedents sourced from:</p>
                <ul>
                    <li>Indian Kanoon (indiankanoon.org) and other legal databases</li>
                    <li>Publicly available court judgments and legal repositories</li>
                </ul>
                <p><strong>Important:</strong></p>
                <ul>
                    <li>Always verify case citations independently</li>
                    <li>Check current validity status (not overruled/distinguished)</li>
                    <li>Case law should be verified through official law reports (AIR, SCC, etc.)</li>
                    <li>We provide attribution to original sources but are not responsible for accuracy of third-party
                        content</li>
                </ul>
                <h3>5. No Warranties</h3>
                <p>LegalMitra is provided "as is" without warranties of any kind, either express or implied. We disclaim
                    all warranties, including but not limited to:</p>
                <ul>
                    <li>Accuracy, completeness, or timeliness of information</li>
                    <li>Merchantability or fitness for a particular purpose</li>
                    <li>Non-infringement of third-party rights</li>
                    <li>Uninterrupted or error-free service</li>
                </ul>
                <h3>6. Limitation of Liability</h3>
                <p>To the fullest extent permitted by law, LegalMitra and its operators shall not be liable for any:</p>
                <ul>
                    <li>Direct, indirect, incidental, special, or consequential damages</li>
                    <li>Loss of data, loss of profits, or business interruption</li>
                    <li>Legal consequences arising from reliance on information provided</li>
                    <li>Damages resulting from unauthorized access to your data</li>
                    <li>Errors or omissions in the content provided</li>
                </ul>
                <p><strong>Maximum liability is limited to the amount paid (if any) for use of this service.</strong>
                </p>
                <h3>7. User Responsibility</h3>
                <p>Users are solely responsible for:</p>
                <ul>
                    <li>‚úÖ Verifying accuracy and applicability of all information</li>
                    <li>‚úÖ Consulting qualified legal professionals before taking legal action</li>
                    <li>‚úÖ Ensuring compliance with applicable laws</li>
                    <li>‚úÖ Making informed decisions based on professional legal advice</li>
                    <li>‚úÖ Checking limitation periods and procedural deadlines</li>
                    <li>‚úÖ Maintaining confidentiality of their own sensitive information</li>
                </ul>
                <h3>8. Data Privacy and Security ‚≠ê **NEW - IMPORTANT**</h3>
                <h4>8.1 Data Collection</h4>
                <p><strong>Current Version (v1.0):</strong></p>
                <ul>
                    <li>We do NOT store your conversations or queries</li>
                    <li>We do NOT collect personal identifiable information</li>
                    <li>All conversations are processed in real-time and not saved</li>
                </ul>
                <p><strong>Future Versions:</strong></p>
                <ul>
                    <li>If we implement conversation history, you will be notified</li>
                    <li>Data handling will comply with the Digital Personal Data Protection (DPDP) Act, 2023</li>
                </ul>
                <h4>8.2 Your Rights Under DPDP Act, 2023</h4>
                <p>As a Data Principal, you have the right to:</p>
                <ul>
                    <li>Access your data (if we store any in future)</li>
                    <li>Correct inaccurate data</li>
                    <li>Request erasure of your data</li>
                    <li>Withdraw consent at any time</li>
                    <li>File complaints with the Data Protection Board</li>
                </ul>
                <h4>8.3 What NOT to Share</h4>
                <p><strong>DO NOT input highly sensitive information including:</strong></p>
                <ul>
                    <li>‚ùå Aadhaar numbers, PAN cards, or government IDs</li>
                    <li>‚ùå Bank account details or financial passwords</li>
                    <li>‚ùå Confidential case details that could identify parties</li>
                    <li>‚ùå Sensitive personal data of third parties</li>
                    <li>‚ùå Trade secrets or confidential business information</li>
                    <li>‚ùå Information that could prejudice ongoing legal proceedings</li>
                </ul>
                <h4>8.4 Data Security</h4>
                <p>While we implement reasonable security measures:</p>
                <ul>
                    <li>We cannot guarantee absolute security of data transmission over the internet</li>
                    <li>Users are responsible for maintaining confidentiality of information they input</li>
                    <li>In case of a data breach (if applicable), we will notify affected users as required by law</li>
                </ul>
                <h3>9. Intellectual Property</h3>
                <h4>9.1 Service Content</h4>
                <ul>
                    <li>LegalMitra's software, design, and original content are proprietary</li>
                    <li>Case laws, statutes, and regulations belong to their respective sources</li>
                </ul>
                <h4>9.2 User-Generated Content</h4>
                <ul>
                    <li>You retain ownership of content you input</li>
                    <li>We may use anonymized data to improve service quality</li>
                    <li>Generated documents are provided for your use but should be reviewed by a legal professional
                    </li>
                </ul>
                <h3>10. Prohibited Uses</h3>
                <p>You agree NOT to use LegalMitra for:</p>
                <ul>
                    <li>‚ùå Illegal activities or purposes</li>
                    <li>‚ùå Harassing, threatening, or defaming others</li>
                    <li>‚ùå Attempting to gain unauthorized access to the system</li>
                    <li>‚ùå Reverse engineering or copying the service</li>
                    <li>‚ùå Commercial resale without authorization</li>
                    <li>‚ùå Automated scraping or bulk data extraction</li>
                </ul>
                <h3>11. Third-Party Services and Links</h3>
                <p>LegalMitra may contain links to third-party websites or services (e.g., Indian Kanoon, government
                    portals):</p>
                <ul>
                    <li>We are not responsible for content or practices of third-party sites</li>
                    <li>Links do not imply endorsement</li>
                    <li>Use of third-party services is subject to their terms and conditions</li>
                </ul>
                <h3>12. Age Restriction</h3>
                <p>LegalMitra is intended for users aged 18 years and above. Users under 18 should use this service only
                    under parental or guardian supervision.</p>
                <h3>13. Jurisdictional Limitations</h3>
                <h4>13.1 Governing Law</h4>
                <p>This disclaimer and your use of LegalMitra are governed by the laws of India.</p>
                <h4>13.2 Jurisdiction</h4>
                <p>Any disputes arising from use of this service shall be subject to the exclusive jurisdiction of the
                    courts in <strong>[Your City, e.g., Bangalore, Karnataka]</strong>, India.</p>
                <h4>13.3 Geographic Scope</h4>
                <ul>
                    <li>This service provides information on Indian laws only</li>
                    <li>Information may not be applicable in other jurisdictions</li>
                    <li>Users outside India use this service at their own risk</li>
                </ul>
                <h3>14. Updates and Amendments</h3>
                <h4>14.1 Right to Modify</h4>
                <p>We reserve the right to modify this disclaimer at any time without prior notice.</p>
                <h4>14.2 Notification of Changes</h4>
                <ul>
                    <li>Material changes will be notified through the platform</li>
                    <li>Updated disclaimer will show "Last Updated" date</li>
                    <li>Continued use after changes constitutes acceptance</li>
                </ul>
                <h4>14.3 User Responsibility</h4>
                <p>Users should review this disclaimer periodically for updates.</p>
                <h3>15. Service Availability</h3>
                <ul>
                    <li>We do not guarantee uninterrupted or error-free service</li>
                    <li>Service may be suspended for maintenance without notice</li>
                    <li>We reserve the right to discontinue service at any time</li>
                </ul>
                <h3>16. Severability</h3>
                <p>If any provision of this disclaimer is found to be invalid or unenforceable, the remaining provisions
                    shall continue in full force and effect.</p>
                <h3>17. Entire Agreement</h3>
                <p>This disclaimer, together with our Privacy Policy and Terms of Service, constitutes the entire
                    agreement between you and LegalMitra regarding use of this service.</p>
                <h3>18. Contact Information ‚≠ê **NEW**</h3>
                <p>For questions, concerns, or complaints regarding this disclaimer:</p>
                <p><strong>Email:</strong> jayamurli1954@gmail.com <strong>Address:</strong> LegalMitra Flat No. 201,
                    Sarvajit Heights Apartment Kembathalli Main Road, Gottigere, Bengaluru 560083] Karnataka India</p>
                <hr>
                <h3>Important Notice</h3>
                <p><strong>BY USING LEGALMITRA, YOU ACKNOWLEDGE THAT YOU HAVE READ, UNDERSTOOD, AND AGREE TO BE BOUND BY
                        THIS DISCLAIMER.</strong></p>
                <p><strong>IF YOU DO NOT AGREE WITH ANY PART OF THIS DISCLAIMER, YOU SHOULD NOT USE THIS
                        SERVICE.</strong></p>
                <hr>
                <p><strong>Last Updated:</strong> December 15, 2025 <strong>Version:</strong> 1.1 <strong>Effective
                        Date:</strong> December 15, 2025</p>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div id="privacy-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('privacy')">&times;</span>
            <h2>Privacy Policy</h2>
            <div>
                <p><strong>Effective Date:</strong> December 15, 2025 <strong>Last Updated:</strong> December 15, 2025
                    <strong>Version:</strong> 1.1
                </p>
                <hr>
                <h3>1. Introduction</h3>
                <p>LegalMitra ("we," "our," or "us") is committed to protecting your privacy and ensuring compliance
                    with the <strong>Digital Personal Data Protection Act, 2023</strong> (DPDP Act) and other applicable
                    data protection laws in India.</p>
                <p>This Privacy Policy explains how we collect, use, disclose, store, and safeguard your personal data
                    when you use our AI-powered legal assistant service ("Service").</p>
                <p><strong>By using LegalMitra, you consent to the data practices described in this Privacy
                        Policy.</strong></p>
                <hr>
                <h3>2. Data Fiduciary Information</h3>
                <p>Under the DPDP Act, 2023, LegalMitra acts as a <strong>Data Fiduciary</strong> for the personal data
                    we process.</p>
                <p><strong>Data Fiduciary Details:</strong></p>
                <ul>
                    <li><strong>Name:</strong> LegalMitra</li>
                    <li><strong>Address:</strong> [Your Registered Business Address]</li>
                    <li><strong>Email:</strong> privacy@legalmitra.com</li>
                    <li><strong>Website:</strong> www.legalmitra.com</li>
                    <li><strong>Data Protection Officer:</strong> [Name, if appointed]</li>
                    <li><strong>Contact:</strong> dpo@legalmitra.com</li>
                </ul>
                <hr>
                <h3>3. Information We Collect</h3>
                <h4>3.1 Personal Data</h4>
                <p>We may collect the following categories of personal data:</p>
                <p><strong>A. Information You Provide:</strong></p>
                <ul>
                    <li>Legal queries and questions</li>
                    <li>Document drafts and text inputs</li>
                    <li>Feedback and communications</li>
                    <li>Contact information (if you reach out to us)</li>
                </ul>
                <p><strong>B. Technical Data (Automatically Collected):</strong></p>
                <ul>
                    <li>IP address</li>
                    <li>Browser type and version</li>
                    <li>Device information (type, operating system)</li>
                    <li>Usage patterns and interaction data</li>
                    <li>Timestamps and session duration</li>
                    <li>Referring URLs</li>
                </ul>
                <p><strong>C. Cookies and Similar Technologies:</strong></p>
                <ul>
                    <li>We may use cookies for analytics and service improvement</li>
                    <li>You can manage cookie preferences in your browser settings</li>
                </ul>
                <h4>3.2 Information We DO NOT Collect</h4>
                <ul>
                    <li>‚ùå We do NOT store your API keys (stored locally on your device)</li>
                    <li>‚ùå We do NOT create user accounts (v1.0)</li>
                    <li>‚ùå We do NOT store conversation history (v1.0)</li>
                    <li>‚ùå We do NOT collect financial information</li>
                    <li>‚ùå We do NOT collect Aadhaar, PAN, or government IDs</li>
                </ul>
                <h4>3.3 Sensitive Personal Data</h4>
                <p>We do NOT intentionally collect sensitive personal data as defined under DPDP Act, including:</p>
                <ul>
                    <li>Financial information</li>
                    <li>Health records</li>
                    <li>Biometric data</li>
                    <li>Sexual orientation</li>
                    <li>Caste or religious beliefs</li>
                </ul>
                <p><strong>If you inadvertently share such information, we cannot guarantee its protection.</strong></p>
                <hr>
                <h3>4. How We Use Your Information</h3>
                <h4>4.1 Legal Basis for Processing</h4>
                <p>We process your personal data based on:</p>
                <ul>
                    <li><strong>Your consent</strong> (by using the service)</li>
                    <li><strong>Legitimate interests</strong> (service improvement, security)</li>
                    <li><strong>Legal obligations</strong> (compliance with Indian laws)</li>
                </ul>
                <h4>4.2 Purpose of Data Processing</h4>
                <p>We use your information to:</p>
                <p>‚úÖ Process your legal queries and generate AI responses ‚úÖ Improve our AI models and service quality ‚úÖ
                    Provide technical support and troubleshoot issues ‚úÖ Ensure security and prevent fraud or abuse ‚úÖ
                    Analyze usage patterns for service optimization ‚úÖ Comply with legal obligations ‚úÖ Respond to your
                    inquiries and feedback</p>
                <h4>4.3 Automated Decision Making</h4>
                <p>Our AI service uses automated processing to generate legal information. However:</p>
                <ul>
                    <li>No automated decisions affect your legal rights</li>
                    <li>You are not subject to automated legal determinations</li>
                    <li>Human review is always recommended for legal matters</li>
                </ul>
                <hr>
                <h3>5. Data Sharing and Disclosure</h3>
                <h4>5.1 Third-Party AI Services</h4>
                <p>Your queries are processed through third-party AI service providers:</p>
                <p><strong>A. Anthropic Claude</strong></p>
                <ul>
                    <li>Purpose: AI response generation</li>
                    <li>Data Shared: Query text, conversation context</li>
                    <li>Privacy Policy: https://www.anthropic.com/privacy</li>
                </ul>
                <p><strong>B. OpenAI GPT (if applicable)</strong></p>
                <ul>
                    <li>Purpose: AI response generation</li>
                    <li>Data Shared: Query text</li>
                    <li>Privacy Policy: https://openai.com/privacy</li>
                </ul>
                <p><strong>C. Google Gemini (if applicable)</strong></p>
                <ul>
                    <li>Purpose: AI response generation</li>
                    <li>Data Shared: Query text</li>
                    <li>Privacy Policy: https://policies.google.com/privacy</li>
                </ul>
                <p><strong>Important:</strong> These services have their own privacy policies. We recommend reviewing
                    them.</p>
                <h4>5.2 Other Third Parties</h4>
                <p>We may share data with:</p>
                <p><strong>A. Indian Kanoon API</strong></p>
                <ul>
                    <li>Purpose: Case law search and retrieval</li>
                    <li>Data Shared: Search queries only</li>
                    <li>Privacy Policy: https://indiankanoon.org/privacy.html</li>
                </ul>
                <p><strong>B. Service Providers</strong></p>
                <ul>
                    <li>Hosting providers</li>
                    <li>Analytics services</li>
                    <li>Technical support providers</li>
                </ul>
                <p><strong>C. Legal Requirements</strong> We may disclose information if required by:</p>
                <ul>
                    <li>Court orders or legal processes</li>
                    <li>Government authorities</li>
                    <li>Law enforcement agencies</li>
                    <li>Compliance with Indian laws</li>
                </ul>
                <h4>5.3 We Do NOT</h4>
                <ul>
                    <li>‚ùå Sell your personal data</li>
                    <li>‚ùå Share data for marketing purposes</li>
                    <li>‚ùå Provide data to advertisers</li>
                    <li>‚ùå Share data without legal basis</li>
                </ul>
                <hr>
                <h3>6. Cross-Border Data Transfer</h3>
                <h4>6.1 Data Location</h4>
                <p>Your data may be processed and stored:</p>
                <ul>
                    <li>On servers located in India</li>
                    <li>On servers of third-party AI providers (may be outside India)</li>
                </ul>
                <h4>6.2 International Transfers</h4>
                <p>When data is transferred outside India:</p>
                <ul>
                    <li>We ensure adequate safeguards are in place</li>
                    <li>Third-party providers comply with DPDP Act requirements</li>
                    <li>Data is transferred only to countries approved by the Government of India (when notified)</li>
                </ul>
                <h4>6.3 Your Rights</h4>
                <p>You have the right to know about cross-border transfers and can withdraw consent for such transfers.
                </p>
                <hr>
                <h3>7. Data Storage, Security, and Retention</h3>
                <h4>7.1 Data Storage</h4>
                <p><strong>Current Implementation (v1.0):</strong></p>
                <ul>
                    <li>We do NOT maintain a centralized database of conversations</li>
                    <li>Queries are processed in real-time</li>
                    <li>No conversation history is stored on our servers</li>
                    <li>Your API keys are stored LOCALLY on your device (.env file)</li>
                </ul>
                <p><strong>Future Implementation (v2.0+):</strong></p>
                <ul>
                    <li>If we implement conversation history, you will be notified</li>
                    <li>You will have the option to enable/disable storage</li>
                    <li>Stored data will be encrypted and secured</li>
                </ul>
                <h4>7.2 Security Measures</h4>
                <p>We implement industry-standard security measures:</p>
                <p>‚úÖ Encryption in transit (HTTPS/TLS) ‚úÖ Secure API communications ‚úÖ Access controls and authentication
                    ‚úÖ Regular security audits ‚úÖ Incident response procedures</p>
                <p><strong>However:</strong></p>
                <ul>
                    <li>No method of transmission is 100% secure</li>
                    <li>You are responsible for securing your device and .env file</li>
                    <li>Do NOT share your API keys with others</li>
                </ul>
                <h4>7.3 Data Retention</h4>
                <p><strong>Current Policy:</strong></p>
                <ul>
                    <li>Real-time processing: Data not retained after response generation</li>
                    <li>Technical logs: Retained for 30 days for debugging</li>
                    <li>Support communications: Retained for 1 year</li>
                    <li>Analytics data: Anonymized and retained for 2 years</li>
                </ul>
                <p><strong>Future Policy:</strong></p>
                <ul>
                    <li>User conversations (if enabled): Retained until user deletion or 1 year</li>
                    <li>You can request deletion at any time</li>
                </ul>
                <hr>
                <h3>8. Your Rights Under DPDP Act, 2023</h3>
                <p>As a <strong>Data Principal</strong>, you have the following rights:</p>
                <h4>8.1 Right to Access</h4>
                <p>You have the right to:</p>
                <ul>
                    <li>Know what personal data we hold about you</li>
                    <li>Obtain a summary of processing activities</li>
                    <li>Request a copy of your data</li>
                </ul>
                <p><strong>How to Exercise:</strong> Email privacy@legalmitra.com</p>
                <h4>8.2 Right to Correction</h4>
                <p>You have the right to:</p>
                <ul>
                    <li>Correct inaccurate or incomplete personal data</li>
                    <li>Update your information</li>
                </ul>
                <p><strong>How to Exercise:</strong> Email privacy@legalmitra.com with corrections</p>
                <h4>8.3 Right to Erasure</h4>
                <p>You have the right to:</p>
                <ul>
                    <li>Request deletion of your personal data</li>
                    <li>Withdraw consent for processing</li>
                </ul>
                <p><strong>How to Exercise:</strong> Email privacy@legalmitra.com with deletion request</p>
                <p><strong>Note:</strong> We may retain data if required by law or for legitimate purposes.</p>
                <h4>8.4 Right to Grievance Redressal</h4>
                <p>You have the right to:</p>
                <ul>
                    <li>File a complaint about data processing</li>
                    <li>Seek resolution of privacy concerns</li>
                </ul>
                <p><strong>How to Exercise:</strong> See Section 11 (Grievance Redressal)</p>
                <h4>8.5 Right to Nominate</h4>
                <p>You have the right to:</p>
                <ul>
                    <li>Nominate another person to exercise your rights in case of death or incapacity</li>
                </ul>
                <p><strong>How to Exercise:</strong> Email privacy@legalmitra.com with nomination details</p>
                <h4>8.6 Response Timeline</h4>
                <p>We will respond to your requests within:</p>
                <ul>
                    <li><strong>7 days:</strong> Acknowledgment of request</li>
                    <li><strong>30 days:</strong> Complete response (may be extended by 30 days if complex)</li>
                </ul>
                <hr>
                <h3>9. Children's Privacy</h3>
                <h4>9.1 Age Restriction</h4>
                <p>LegalMitra is NOT intended for children under 18 years of age.</p>
                <h4>9.2 Parental Consent</h4>
                <p>If you are under 18:</p>
                <ul>
                    <li>You must have verifiable parental consent to use the service</li>
                    <li>We may request proof of parental consent</li>
                </ul>
                <h4>9.3 Data of Minors</h4>
                <p>If we discover we have collected data from a child under 18 without parental consent:</p>
                <ul>
                    <li>We will delete the data immediately</li>
                    <li>We will notify the parent/guardian (if contact information is available)</li>
                </ul>
                <h4>9.4 Reporting</h4>
                <p>If you believe we have collected data from a minor without consent:</p>
                <ul>
                    <li>Email: privacy@legalmitra.com</li>
                    <li>Subject: "Minor Data Concern"</li>
                </ul>
                <hr>
                <h3>10. Data Breach Notification</h3>
                <h4>10.1 Our Obligations</h4>
                <p>In the event of a data breach that may affect you:</p>
                <ul>
                    <li>We will notify the <strong>Data Protection Board of India</strong> as required by law</li>
                    <li>We will notify affected users within <strong>72 hours</strong> of discovering the breach</li>
                    <li>We will provide details about the breach and recommended actions</li>
                </ul>
                <h4>10.2 Your Actions</h4>
                <p>If you suspect unauthorized access to your data:</p>
                <ul>
                    <li>Contact us immediately at security@legalmitra.com</li>
                    <li>Change your API keys</li>
                    <li>Review your account activity (if applicable)</li>
                </ul>
                <h4>10.3 Our Response</h4>
                <p>We will:</p>
                <ul>
                    <li>Investigate the incident</li>
                    <li>Take corrective measures</li>
                    <li>Cooperate with authorities</li>
                    <li>Provide updates on resolution</li>
                </ul>
                <hr>
                <h3>11. Grievance Redressal Mechanism</h3>
                <h4>11.1 Grievance Officer</h4>
                <p><strong>Name:</strong> [Grievance Officer Name] <strong>Designation:</strong> Grievance Redressal
                    Officer <strong>Email:</strong> grievances@legalmitra.com <strong>Phone:</strong> [Contact Number]
                    <strong>Address:</strong> [Business Address]
                </p>
                <p><strong>Office Hours:</strong> Monday to Friday, 10:00 AM to 6:00 PM IST</p>
                <h4>11.2 Filing a Complaint</h4>
                <p>To file a privacy-related complaint:</p>
                <p><strong>Step 1:</strong> Send an email to grievances@legalmitra.com with:</p>
                <ul>
                    <li>Your name and contact information</li>
                    <li>Description of the issue</li>
                    <li>Supporting documents (if any)</li>
                </ul>
                <p><strong>Step 2:</strong> We will acknowledge within 7 days</p>
                <p><strong>Step 3:</strong> We will resolve within 30 days (may extend by 30 days if complex)</p>
                <h4>11.3 Escalation</h4>
                <p>If not satisfied with our response:</p>
                <ul>
                    <li>You can approach the <strong>Data Protection Board of India</strong></li>
                    <li>Website: [Will be notified when established]</li>
                    <li>Email: [Will be notified when established]</li>
                </ul>
                <hr>
                <h3>12. Cookies and Tracking Technologies</h3>
                <h4>12.1 What Are Cookies</h4>
                <p>Cookies are small text files stored on your device when you visit our website.</p>
                <h4>12.2 Types of Cookies We Use</h4>
                <p><strong>A. Essential Cookies:</strong></p>
                <ul>
                    <li>Required for service functionality</li>
                    <li>Cannot be disabled</li>
                </ul>
                <p><strong>B. Analytics Cookies:</strong></p>
                <ul>
                    <li>Track usage patterns</li>
                    <li>Help improve service</li>
                    <li>Can be disabled in browser settings</li>
                </ul>
                <p><strong>C. Performance Cookies:</strong></p>
                <ul>
                    <li>Monitor service performance</li>
                    <li>Identify errors</li>
                    <li>Can be disabled</li>
                </ul>
                <h4>12.3 Managing Cookies</h4>
                <p>You can control cookies through:</p>
                <ul>
                    <li>Browser settings (Chrome, Firefox, Safari, Edge)</li>
                    <li>Cookie consent banner on our website</li>
                    <li>Privacy settings in your device</li>
                </ul>
                <h4>12.4 Third-Party Cookies</h4>
                <p>Third-party services may set their own cookies:</p>
                <ul>
                    <li>Google Analytics (if used)</li>
                    <li>AI service providers</li>
                    <li>Hosting providers</li>
                </ul>
                <hr>
                <h3>13. Do Not Track Signals</h3>
                <p>We do not currently respond to "Do Not Track" (DNT) browser signals. If we implement DNT response in
                    the future, we will update this policy.</p>
                <hr>
                <h3>14. Links to Third-Party Websites</h3>
                <p>Our service may contain links to third-party websites (e.g., Indian Kanoon, government portals):</p>
                <ul>
                    <li>We are not responsible for their privacy practices</li>
                    <li>We recommend reviewing their privacy policies</li>
                    <li>Links do not imply endorsement</li>
                </ul>
                <hr>
                <h3>15. Business Transfers</h3>
                <p>If LegalMitra is involved in a merger, acquisition, or sale of assets:</p>
                <ul>
                    <li>Your personal data may be transferred</li>
                    <li>We will notify you via email or prominent notice</li>
                    <li>The new entity will be bound by this Privacy Policy</li>
                    <li>You will have the right to withdraw consent</li>
                </ul>
                <hr>
                <h3>16. Your Consent and Choices</h3>
                <h4>16.1 Consent</h4>
                <p>By using LegalMitra, you consent to:</p>
                <ul>
                    <li>Collection and processing of your data as described</li>
                    <li>Sharing data with third-party AI services</li>
                    <li>Cross-border data transfers (if applicable)</li>
                </ul>
                <h4>16.2 Withdrawal of Consent</h4>
                <p>You can withdraw consent at any time by:</p>
                <ul>
                    <li>Stopping use of the service</li>
                    <li>Requesting data deletion</li>
                    <li>Emailing privacy@legalmitra.com</li>
                </ul>
                <h4>16.3 Consequences of Withdrawal</h4>
                <p>If you withdraw consent:</p>
                <ul>
                    <li>We will stop processing your data</li>
                    <li>We will delete your data (unless required by law)</li>
                    <li>You may not be able to use certain features</li>
                </ul>
                <hr>
                <h3>17. Updates to This Privacy Policy</h3>
                <h4>17.1 Changes</h4>
                <p>We may update this Privacy Policy to:</p>
                <ul>
                    <li>Reflect changes in our practices</li>
                    <li>Comply with new laws or regulations</li>
                    <li>Improve clarity and transparency</li>
                </ul>
                <h4>17.2 Notification</h4>
                <p>We will notify you of material changes through:</p>
                <ul>
                    <li>Email notification (if we have your email)</li>
                    <li>Prominent notice on our website</li>
                    <li>In-app notification (if applicable)</li>
                </ul>
                <h4>17.3 Effective Date</h4>
                <p>Changes become effective 30 days after posting unless:</p>
                <ul>
                    <li>Required by law to be immediate</li>
                    <li>Changes are minor or administrative</li>
                </ul>
                <h4>17.4 Your Acceptance</h4>
                <p>Continued use after changes constitutes acceptance of the updated policy.</p>
                <hr>
                <h3>18. International Users</h3>
                <p>If you are accessing LegalMitra from outside India:</p>
                <ul>
                    <li>Your data may be transferred to India</li>
                    <li>Indian data protection laws will apply</li>
                    <li>You consent to transfer and processing in India</li>
                    <li>Additional local laws may apply to you</li>
                </ul>
                <hr>
                <h3>19. Data Protection Impact Assessment</h3>
                <p>We conduct regular Data Protection Impact Assessments (DPIA) to:</p>
                <ul>
                    <li>Identify privacy risks</li>
                    <li>Implement mitigation measures</li>
                    <li>Ensure DPDP Act compliance</li>
                    <li>Improve data protection practices</li>
                </ul>
                <hr>
                <h3>20. Contact Information</h3>
                <p>For privacy-related questions, concerns, or requests:</p>
                <p><strong>General Privacy Inquiries:</strong> Email: jayamurli1954@gmail.com</p>
                <hr>
                <h3>21. Compliance and Certifications</h3>
                <p>LegalMitra is committed to compliance with:</p>
                <ul>
                    <li>Digital Personal Data Protection Act, 2023</li>
                    <li>Information Technology Act, 2000</li>
                    <li>Information Technology (Reasonable Security Practices) Rules, 2011</li>
                    <li>Other applicable Indian laws and regulations</li>
                </ul>
                <p><strong>Certifications:</strong> [List any relevant certifications when obtained]</p>
                <hr>
                <h3>22. Questions and Feedback</h3>
                <p>We value your feedback on our privacy practices. If you have:</p>
                <ul>
                    <li>Questions about this policy</li>
                    <li>Suggestions for improvement</li>
                    <li>Concerns about data handling</li>
                </ul>
                <p>Please contact us at: jayamurli1954@gmail.com</p>
                <hr>
                <h3>23. Legal Disclaimer</h3>
                <p>This Privacy Policy is a binding legal document. By using LegalMitra, you acknowledge that you have
                    read, understood, and agree to be bound by this Privacy Policy.</p>
                <p><strong>If you do not agree with any part of this Privacy Policy, you must not use our
                        service.</strong></p>
                <hr>
                <p><strong>Last Updated:</strong> December 15, 2025 <strong>Version:</strong> 1.1 <strong>Effective
                        Date:</strong> December 15, 2025</p>
                <p><strong>¬© 2025 LegalMitra. All Rights Reserved.</strong></p>
                <hr>
                <h3>APPENDIX A: Definitions</h3>
                <p><strong>Data Principal:</strong> Individual whose personal data is being processed (You, the user)
                </p>
                <p><strong>Data Fiduciary:</strong> Entity that determines purpose and means of processing (LegalMitra)
                </p>
                <p><strong>Data Processor:</strong> Entity that processes data on behalf of Data Fiduciary (Third-party
                    AI services)</p>
                <p><strong>Personal Data:</strong> Any data relating to an identified or identifiable individual</p>
                <p><strong>Sensitive Personal Data:</strong> Data about financial, health, biometric, sexual
                    orientation, etc.</p>
                <p><strong>Processing:</strong> Any operation performed on personal data (collection, storage, use,
                    disclosure, deletion)</p>
                <p><strong>Consent:</strong> Free, specific, informed, and unambiguous indication of agreement</p>
                <p><strong>Data Breach:</strong> Unauthorized access, disclosure, acquisition, or loss of personal data
                </p>
                <p><strong>DPDP Act:</strong> Digital Personal Data Protection Act, 2023</p>
                <hr>
                <p>[END OF PRIVACY POLICY]</p>
            </div>
        </div>
    </div>

    <!-- Terms of Use Modal -->
    <div id="terms-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('terms')">&times;</span>
            <h2>Terms of Use</h2>
            <div>
                <p><strong>Effective Date:</strong> December 15, 2025 <strong>Last Updated:</strong> December 15, 2025
                    <strong>Version:</strong> 1.1
                </p>
                <hr>
                <h3>1. Acceptance of Terms</h3>
                <h4>1.1 Agreement to Terms</h4>
                <p>By accessing, browsing, or using LegalMitra ("Service," "Platform," "we," "our," or "us"), you
                    ("User," "you," or "your") agree to be bound by these Terms of Use ("Terms").</p>
                <h4>1.2 Legal Binding</h4>
                <p>These Terms constitute a legally binding agreement between you and LegalMitra.</p>
                <h4>1.3 Non-Acceptance</h4>
                <p><strong>IF YOU DO NOT AGREE WITH ANY PART OF THESE TERMS, YOU MUST NOT USE THIS SERVICE.</strong></p>
                <h4>1.4 Additional Terms</h4>
                <p>These Terms incorporate by reference:</p>
                <ul>
                    <li>Privacy Policy</li>
                    <li>Disclaimer</li>
                    <li>Cookie Policy (if applicable)</li>
                    <li>Any additional guidelines or rules posted on the Platform</li>
                </ul>
                <hr>
                <h3>2. Description of Service</h3>
                <h4>2.1 Service Overview</h4>
                <p>LegalMitra is an AI-powered legal assistant that provides:</p>
                <ul>
                    <li>Legal information and research assistance</li>
                    <li>Case law searches and citations</li>
                    <li>Document drafting capabilities</li>
                    <li>Compliance guidance</li>
                    <li>Procedural information</li>
                    <li>Industry-specific legal guidance</li>
                </ul>
                <p><strong>All services relate to Indian laws and regulations.</strong></p>
                <h4>2.2 Nature of Service</h4>
                <p>LegalMitra is an <strong>informational tool</strong> and NOT:</p>
                <ul>
                    <li>‚ùå A law firm or legal practice</li>
                    <li>‚ùå A substitute for professional legal counsel</li>
                    <li>‚ùå A provider of legal advice</li>
                    <li>‚ùå Your attorney or legal representative</li>
                </ul>
                <h4>2.3 Service Availability</h4>
                <ul>
                    <li>Service is provided "as available"</li>
                    <li>We do not guarantee uninterrupted access</li>
                    <li>Service may be modified, suspended, or discontinued at any time</li>
                    <li>We may impose usage limits at our discretion</li>
                </ul>
                <h4>2.4 Beta Features</h4>
                <p>Some features may be in beta or testing phase:</p>
                <ul>
                    <li>Marked as "Beta" or "Experimental"</li>
                    <li>May not work as expected</li>
                    <li>May be discontinued without notice</li>
                    <li>Feedback is appreciated</li>
                </ul>
                <hr>
                <h3>3. Eligibility and User Requirements</h3>
                <h4>3.1 Age Requirement</h4>
                <p>You must be at least <strong>18 years old</strong> to use this service.</p>
                <h4>3.2 Legal Capacity</h4>
                <p>You must have the legal capacity to enter into binding agreements under Indian law.</p>
                <h4>3.3 Minors</h4>
                <p>If you are under 18:</p>
                <ul>
                    <li>You must have verifiable parental/guardian consent</li>
                    <li>Your parent/guardian agrees to these Terms</li>
                    <li>We may request proof of consent</li>
                </ul>
                <h4>3.4 Prohibited Users</h4>
                <p>You may NOT use this service if:</p>
                <ul>
                    <li>You are legally prohibited from using such services</li>
                    <li>Your account has been previously suspended or terminated</li>
                    <li>You are accessing from a jurisdiction where the service is prohibited</li>
                </ul>
                <h4>3.5 Verification</h4>
                <p>We reserve the right to verify your eligibility at any time.</p>
                <hr>
                <h3>4. Acceptable Use Policy</h3>
                <h4>4.1 Permitted Uses</h4>
                <p>You may use LegalMitra to: ‚úÖ Research Indian laws and regulations ‚úÖ Obtain general legal information
                    ‚úÖ Draft legal documents (for review by a lawyer) ‚úÖ Search case laws and precedents ‚úÖ Understand
                    compliance requirements ‚úÖ Learn about legal procedures</p>
                <h4>4.2 Prohibited Uses</h4>
                <p>You agree NOT to use LegalMitra for:</p>
                <p><strong>A. Illegal Activities:</strong></p>
                <ul>
                    <li>‚ùå Any illegal or criminal purpose</li>
                    <li>‚ùå Violating any local, state, or national laws</li>
                    <li>‚ùå Infringing intellectual property rights</li>
                    <li>‚ùå Committing fraud or misrepresentation</li>
                </ul>
                <p><strong>B. Harmful Content:</strong></p>
                <ul>
                    <li>‚ùå Uploading malicious code or viruses</li>
                    <li>‚ùå Attempting to gain unauthorized access</li>
                    <li>‚ùå Interfering with service operation</li>
                    <li>‚ùå Reverse engineering or decompiling</li>
                </ul>
                <p><strong>C. Abuse:</strong></p>
                <ul>
                    <li>‚ùå Harassing, threatening, or defaming others</li>
                    <li>‚ùå Impersonating any person or entity</li>
                    <li>‚ùå Spamming or sending unsolicited communications</li>
                    <li>‚ùå Automated scraping or data mining</li>
                </ul>
                <p><strong>D. Commercial Misuse:</strong></p>
                <ul>
                    <li>‚ùå Reselling or redistributing the service</li>
                    <li>‚ùå Using for competing services</li>
                    <li>‚ùå Commercial use without authorization</li>
                    <li>‚ùå Bulk or automated queries</li>
                </ul>
                <p><strong>E. Confidentiality Violations:</strong></p>
                <ul>
                    <li>‚ùå Sharing confidential case information</li>
                    <li>‚ùå Violating attorney-client privilege</li>
                    <li>‚ùå Disclosing sensitive personal data of others</li>
                    <li>‚ùå Breaching court-imposed confidentiality</li>
                </ul>
                <h4>4.3 Content Standards</h4>
                <p>Any content you input must:</p>
                <ul>
                    <li>Be lawful and truthful</li>
                    <li>Not violate any third-party rights</li>
                    <li>Not contain offensive or harmful material</li>
                    <li>Comply with applicable laws</li>
                </ul>
                <h4>4.4 Monitoring</h4>
                <p>We reserve the right to:</p>
                <ul>
                    <li>Monitor usage patterns</li>
                    <li>Investigate suspected violations</li>
                    <li>Remove or disable access to content</li>
                    <li>Report illegal activities to authorities</li>
                </ul>
                <h4>4.5 Consequences of Violation</h4>
                <p>If you violate these Terms, we may:</p>
                <ul>
                    <li>Suspend or terminate your access</li>
                    <li>Remove your content</li>
                    <li>Report to law enforcement</li>
                    <li>Seek legal remedies</li>
                    <li>Refuse future service</li>
                </ul>
                <hr>
                <h3>5. User Accounts (If Applicable in Future Versions)</h3>
                <h4>5.1 Account Creation</h4>
                <p><strong>Current Version (v1.0):</strong> No user accounts required</p>
                <p><strong>Future Versions (v2.0+):</strong></p>
                <ul>
                    <li>You may need to create an account</li>
                    <li>You must provide accurate information</li>
                    <li>You are responsible for account security</li>
                    <li>One account per person</li>
                </ul>
                <h4>5.2 Account Security</h4>
                <p>You are responsible for:</p>
                <ul>
                    <li>Maintaining confidentiality of credentials</li>
                    <li>All activities under your account</li>
                    <li>Notifying us of unauthorized access</li>
                    <li>Logging out after each session</li>
                </ul>
                <h4>5.3 Account Termination</h4>
                <p>We may terminate accounts that:</p>
                <ul>
                    <li>Violate these Terms</li>
                    <li>Are inactive for extended periods</li>
                    <li>Are associated with fraudulent activity</li>
                    <li>Are requested for closure by the user</li>
                </ul>
                <hr>
                <h3>6. Intellectual Property Rights</h3>
                <h4>6.1 Our Intellectual Property</h4>
                <p><strong>Owned by LegalMitra:</strong></p>
                <ul>
                    <li>Service design, layout, and interface</li>
                    <li>Software, code, and algorithms</li>
                    <li>Logos, trademarks, and branding</li>
                    <li>Original content and documentation</li>
                    <li>AI model configurations</li>
                </ul>
                <p><strong>Protected By:</strong></p>
                <ul>
                    <li>Copyright laws</li>
                    <li>Trademark laws</li>
                    <li>Trade secret laws</li>
                    <li>Patent laws (if applicable)</li>
                </ul>
                <h4>6.2 License to Use</h4>
                <p>We grant you a limited, non-exclusive, non-transferable, revocable license to:</p>
                <ul>
                    <li>Access and use the service</li>
                    <li>For personal, non-commercial purposes</li>
                    <li>In accordance with these Terms</li>
                </ul>
                <p><strong>You MAY NOT:</strong></p>
                <ul>
                    <li>‚ùå Copy, modify, or distribute our content</li>
                    <li>‚ùå Create derivative works</li>
                    <li>‚ùå Reverse engineer the software</li>
                    <li>‚ùå Remove copyright notices</li>
                    <li>‚ùå Use our branding without permission</li>
                </ul>
                <h4>6.3 Third-Party Content</h4>
                <p><strong>Case Laws and Statutes:</strong></p>
                <ul>
                    <li>Belong to Government of India/Courts</li>
                    <li>Used under fair use or public domain</li>
                    <li>Properly attributed to sources (e.g., Indian Kanoon)</li>
                </ul>
                <p><strong>AI Model Responses:</strong></p>
                <ul>
                    <li>Generated by third-party AI services</li>
                    <li>Subject to their terms and licenses</li>
                </ul>
                <h4>6.4 User-Generated Content</h4>
                <p><strong>You Retain Ownership Of:</strong></p>
                <ul>
                    <li>Queries you input</li>
                    <li>Documents you create</li>
                    <li>Content you provide</li>
                </ul>
                <p><strong>You Grant Us:</strong></p>
                <ul>
                    <li>Right to process your input</li>
                    <li>Right to use anonymized data for improvement</li>
                    <li>Right to store (if you enable conversation history)</li>
                </ul>
                <p><strong>We Do NOT Claim:</strong></p>
                <ul>
                    <li>Ownership of your content</li>
                    <li>Rights to your legal work product</li>
                    <li>Rights to your confidential information</li>
                </ul>
                <h4>6.5 Feedback and Suggestions</h4>
                <p>If you provide feedback, suggestions, or ideas:</p>
                <ul>
                    <li>We may use them without compensation</li>
                    <li>You grant us perpetual, worldwide license</li>
                    <li>No confidentiality obligation on our part</li>
                    <li>We are not obligated to implement suggestions</li>
                </ul>
                <h4>6.6 Copyright Infringement</h4>
                <p>If you believe your copyright has been infringed:</p>
                <ul>
                    <li>Email: legal@legalmitra.com</li>
                    <li>Provide: Details of copyrighted work, location of infringement, contact information</li>
                    <li>We will investigate and take appropriate action</li>
                </ul>
                <hr>
                <h3>7. API Keys and Third-Party Services</h3>
                <h4>7.1 Your Responsibility</h4>
                <p>You are responsible for:</p>
                <ul>
                    <li>Obtaining your own API keys (Anthropic, OpenAI, etc.)</li>
                    <li>Complying with third-party service terms</li>
                    <li>Costs associated with API usage</li>
                    <li>Securing your API keys</li>
                </ul>
                <h4>7.2 We Are NOT Responsible For:</h4>
                <ul>
                    <li>‚ùå Third-party service availability</li>
                    <li>‚ùå Third-party pricing changes</li>
                    <li>‚ùå Third-party terms violations</li>
                    <li>‚ùå Loss of API access</li>
                </ul>
                <h4>7.3 API Key Security</h4>
                <p><strong>IMPORTANT:</strong></p>
                <ul>
                    <li>Store API keys in .env file only</li>
                    <li>Never share your API keys</li>
                    <li>Never commit API keys to GitHub</li>
                    <li>Rotate keys if compromised</li>
                </ul>
                <h4>7.4 Third-Party Terms</h4>
                <p>You must comply with terms of:</p>
                <ul>
                    <li>Anthropic Claude</li>
                    <li>OpenAI (if used)</li>
                    <li>Indian Kanoon API</li>
                    <li>Any other integrated services</li>
                </ul>
                <hr>
                <h3>8. Payment and Subscription (Future Feature)</h3>
                <h4>8.1 Current Version (v1.0)</h4>
                <p><strong>FREE TO USE</strong> - No payment required</p>
                <h4>8.2 Future Versions (v2.0+)</h4>
                <p>If we introduce paid features:</p>
                <p><strong>A. Pricing:</strong></p>
                <ul>
                    <li>Clearly displayed before purchase</li>
                    <li>Subject to change with notice</li>
                    <li>May vary by region or currency</li>
                </ul>
                <p><strong>B. Payment Methods:</strong></p>
                <ul>
                    <li>Credit/debit cards</li>
                    <li>UPI, net banking</li>
                    <li>Other methods as available</li>
                </ul>
                <p><strong>C. Billing:</strong></p>
                <ul>
                    <li>Monthly or annual subscriptions</li>
                    <li>Auto-renewal unless cancelled</li>
                    <li>Refund policy as stated</li>
                </ul>
                <p><strong>D. Taxes:</strong></p>
                <ul>
                    <li>Prices may exclude GST</li>
                    <li>You are responsible for applicable taxes</li>
                </ul>
                <h4>8.3 Refund Policy (When Applicable)</h4>
                <ul>
                    <li>Refunds handled case-by-case</li>
                    <li>No refunds for completed services</li>
                    <li>Contact support for refund requests</li>
                </ul>
                <hr>
                <h3>9. Disclaimer of Warranties</h3>
                <h4>9.1 "AS IS" Basis</h4>
                <p>THE SERVICE IS PROVIDED <strong>"AS IS"</strong> AND <strong>"AS AVAILABLE"</strong> WITHOUT
                    WARRANTIES OF ANY KIND.</p>
                <h4>9.2 We Disclaim All Warranties</h4>
                <p>Including but not limited to:</p>
                <ul>
                    <li>‚ùå Warranties of merchantability</li>
                    <li>‚ùå Fitness for a particular purpose</li>
                    <li>‚ùå Non-infringement</li>
                    <li>‚ùå Accuracy or completeness</li>
                    <li>‚ùå Uninterrupted or error-free service</li>
                    <li>‚ùå Security or virus-free operation</li>
                </ul>
                <h4>9.3 No Legal Advice</h4>
                <ul>
                    <li>Service does NOT provide legal advice</li>
                    <li>Responses are informational only</li>
                    <li>Not a substitute for qualified counsel</li>
                    <li>No attorney-client relationship created</li>
                </ul>
                <h4>9.4 AI Limitations</h4>
                <p>AI responses may:</p>
                <ul>
                    <li>Contain errors or inaccuracies</li>
                    <li>Be incomplete or outdated</li>
                    <li>Misinterpret queries</li>
                    <li>Provide irrelevant information</li>
                    <li>Fail to cite all relevant laws</li>
                </ul>
                <p><strong>YOU MUST VERIFY ALL INFORMATION INDEPENDENTLY.</strong></p>
                <h4>9.5 Third-Party Reliability</h4>
                <p>We do not warrant:</p>
                <ul>
                    <li>Accuracy of third-party content</li>
                    <li>Availability of third-party services</li>
                    <li>Quality of AI model responses</li>
                    <li>Validity of case law citations</li>
                </ul>
                <hr>
                <h3>10. Limitation of Liability</h3>
                <h4>10.1 Maximum Liability</h4>
                <p>TO THE FULLEST EXTENT PERMITTED BY INDIAN LAW, OUR TOTAL LIABILITY TO YOU SHALL NOT EXCEED:</p>
                <ul>
                    <li><strong>‚Çπ10,000 (Ten Thousand Rupees)</strong>, OR</li>
                    <li><strong>The amount you paid us (if any) in the 12 months preceding the claim</strong></li>
                </ul>
                <p><strong>Whichever is less.</strong></p>
                <h4>10.2 Excluded Damages</h4>
                <p>WE SHALL NOT BE LIABLE FOR:</p>
                <ul>
                    <li>‚ùå Indirect, incidental, or consequential damages</li>
                    <li>‚ùå Loss of profits, revenue, or business opportunities</li>
                    <li>‚ùå Loss of data or information</li>
                    <li>‚ùå Legal fees or court costs</li>
                    <li>‚ùå Damages from reliance on service</li>
                    <li>‚ùå Third-party claims</li>
                    <li>‚ùå Service interruptions or errors</li>
                </ul>
                <h4>10.3 Legal Consequences</h4>
                <p>WE ARE NOT LIABLE FOR:</p>
                <ul>
                    <li>Legal outcomes based on our information</li>
                    <li>Missed deadlines or limitation periods</li>
                    <li>Incorrect legal strategies</li>
                    <li>Court judgments or decisions</li>
                    <li>Regulatory actions</li>
                    <li>Financial losses</li>
                </ul>
                <h4>10.4 Exceptions</h4>
                <p>This limitation does NOT apply to:</p>
                <ul>
                    <li>Gross negligence or willful misconduct</li>
                    <li>Fraud or fraudulent misrepresentation</li>
                    <li>Death or personal injury caused by our negligence</li>
                    <li>Liabilities that cannot be limited by law</li>
                </ul>
                <h4>10.5 Basis of Bargain</h4>
                <p>These limitations reflect the allocation of risk between you and us and form an essential basis of
                    our agreement.</p>
                <hr>
                <h3>11. Indemnification</h3>
                <h4>11.1 Your Agreement to Indemnify</h4>
                <p>You agree to <strong>indemnify, defend, and hold harmless</strong> LegalMitra, its officers,
                    directors, employees, and agents from:</p>
                <p><strong>A. Claims arising from:</strong></p>
                <ul>
                    <li>Your use or misuse of the service</li>
                    <li>Your violation of these Terms</li>
                    <li>Your violation of any laws or regulations</li>
                    <li>Your infringement of third-party rights</li>
                    <li>Content you provide or create</li>
                    <li>Your negligence or misconduct</li>
                </ul>
                <p><strong>B. Including:</strong></p>
                <ul>
                    <li>Legal fees and costs</li>
                    <li>Damages and settlements</li>
                    <li>Regulatory fines or penalties</li>
                    <li>Court judgments</li>
                </ul>
                <h4>11.2 Process</h4>
                <p>If a claim is made:</p>
                <ul>
                    <li>We will notify you promptly</li>
                    <li>You will cooperate in defense</li>
                    <li>We may participate in defense</li>
                    <li>You may not settle without our consent</li>
                </ul>
                <hr>
                <h3>12. Dispute Resolution</h3>
                <h4>12.1 Informal Resolution</h4>
                <p>Before initiating formal proceedings:</p>
                <ul>
                    <li>Contact us at legal@legalmitra.com</li>
                    <li>Describe the dispute in detail</li>
                    <li>We will attempt good-faith resolution</li>
                    <li>Allow 30 days for resolution attempts</li>
                </ul>
                <h4>12.2 Negotiation</h4>
                <p>Both parties agree to negotiate in good faith to resolve disputes.</p>
                <h4>12.3 Mediation (Optional)</h4>
                <p>If negotiation fails, parties may agree to mediation by:</p>
                <ul>
                    <li>A mutually acceptable mediator</li>
                    <li>Under Indian mediation rules</li>
                    <li>Costs shared equally</li>
                </ul>
                <h4>12.4 Arbitration</h4>
                <p>If informal resolution fails, disputes shall be resolved by <strong>binding arbitration</strong>:</p>
                <p><strong>A. Arbitration Rules:</strong></p>
                <ul>
                    <li>Conducted under Arbitration and Conciliation Act, 1996</li>
                    <li>Single arbitrator mutually appointed</li>
                    <li>Seat: [Your City], India</li>
                    <li>Language: English</li>
                    <li>Decision is final and binding</li>
                </ul>
                <p><strong>B. Exceptions to Arbitration:</strong></p>
                <ul>
                    <li>Intellectual property disputes</li>
                    <li>Injunctive relief matters</li>
                    <li>Small claims court matters (if eligible)</li>
                </ul>
                <h4>12.5 Class Action Waiver</h4>
                <p><strong>YOU AGREE THAT DISPUTES WILL BE RESOLVED ON AN INDIVIDUAL BASIS.</strong></p>
                <ul>
                    <li>No class actions or representative proceedings</li>
                    <li>No consolidation with other users' claims</li>
                    <li>No arbitration or litigation on behalf of others</li>
                </ul>
                <h4>12.6 Limitation Period</h4>
                <p>Claims must be brought within <strong>1 year</strong> of the cause of action arising, or be forever
                    barred.</p>
                <hr>
                <h3>13. Governing Law and Jurisdiction</h3>
                <h4>13.1 Governing Law</h4>
                <p>These Terms are governed by:</p>
                <ul>
                    <li><strong>Laws of India</strong></li>
                    <li>Without regard to conflict of law principles</li>
                </ul>
                <h4>13.2 Exclusive Jurisdiction</h4>
                <p>Subject to arbitration provisions, disputes shall be under the exclusive jurisdiction of:</p>
                <ul>
                    <li><strong>Courts in [Your City, e.g., Bangalore], Karnataka, India</strong></li>
                </ul>
                <h4>13.3 Venue</h4>
                <p>You consent to personal jurisdiction and venue in these courts.</p>
                <h4>13.4 Language</h4>
                <p>These Terms are written in English. Translations (if any) are for convenience only.</p>
                <hr>
                <h3>14. Termination</h3>
                <h4>14.1 Termination by You</h4>
                <p>You may stop using the service at any time:</p>
                <ul>
                    <li>No formal termination required (v1.0)</li>
                    <li>Simply cease accessing the service</li>
                    <li>Delete any locally stored data</li>
                </ul>
                <h4>14.2 Termination by Us</h4>
                <p>We may terminate or suspend your access:</p>
                <p><strong>Immediately if:</strong></p>
                <ul>
                    <li>You violate these Terms</li>
                    <li>You engage in illegal activities</li>
                    <li>You abuse or misuse the service</li>
                    <li>Required by law or regulation</li>
                    <li>For security or safety reasons</li>
                </ul>
                <p><strong>With Notice:</strong></p>
                <ul>
                    <li>We discontinue the service</li>
                    <li>We modify service substantially</li>
                    <li>For any other reason with 30 days' notice</li>
                </ul>
                <h4>14.3 Effect of Termination</h4>
                <p>Upon termination:</p>
                <ul>
                    <li>Your right to use service ceases immediately</li>
                    <li>We may delete your data (if stored)</li>
                    <li>Provisions that should survive will survive</li>
                    <li>You remain liable for any obligations</li>
                </ul>
                <h4>14.4 Survival</h4>
                <p>The following sections survive termination:</p>
                <ul>
                    <li>Intellectual Property Rights</li>
                    <li>Disclaimer of Warranties</li>
                    <li>Limitation of Liability</li>
                    <li>Indemnification</li>
                    <li>Governing Law</li>
                    <li>Dispute Resolution</li>
                </ul>
                <hr>
                <h3>15. Modifications to Terms</h3>
                <h4>15.1 Right to Modify</h4>
                <p>We reserve the right to modify these Terms at any time.</p>
                <h4>15.2 Notice of Changes</h4>
                <p>We will notify you of material changes by:</p>
                <ul>
                    <li>Email (if we have your email address)</li>
                    <li>Prominent notice on the platform</li>
                    <li>Update to "Last Updated" date</li>
                </ul>
                <h4>15.3 Effective Date</h4>
                <p>Changes become effective:</p>
                <ul>
                    <li><strong>30 days after posting</strong>, unless</li>
                    <li>Required by law to be immediate</li>
                    <li>Notified otherwise</li>
                </ul>
                <h4>15.4 Your Acceptance</h4>
                <p>Continued use after changes constitutes acceptance of modified Terms.</p>
                <h4>15.5 Objection to Changes</h4>
                <p>If you object to changes:</p>
                <ul>
                    <li>Stop using the service before effective date</li>
                    <li>Contact us to terminate (if applicable)</li>
                    <li>Changes will not apply to you after termination</li>
                </ul>
                <hr>
                <h3>16. General Provisions</h3>
                <h4>16.1 Entire Agreement</h4>
                <p>These Terms, together with Privacy Policy and Disclaimer, constitute the entire agreement between you
                    and us.</p>
                <h4>16.2 Severability</h4>
                <p>If any provision is found invalid or unenforceable:</p>
                <ul>
                    <li>That provision will be modified to the minimum extent necessary</li>
                    <li>Or removed if modification is not possible</li>
                    <li>Remaining provisions continue in full force</li>
                </ul>
                <h4>16.3 Waiver</h4>
                <p>Failure to enforce any provision does not constitute a waiver of:</p>
                <ul>
                    <li>That provision</li>
                    <li>Our right to enforce it in the future</li>
                    <li>Any other provision</li>
                </ul>
                <h4>16.4 Assignment</h4>
                <p><strong>You may NOT:</strong></p>
                <ul>
                    <li>Transfer or assign these Terms</li>
                    <li>Transfer your rights or obligations</li>
                </ul>
                <p><strong>We may:</strong></p>
                <ul>
                    <li>Assign these Terms without notice</li>
                    <li>Transfer to affiliates or successors</li>
                    <li>Subcontract obligations</li>
                </ul>
                <h4>16.5 No Third-Party Beneficiaries</h4>
                <p>These Terms are for your and our benefit only:</p>
                <ul>
                    <li>No third party has rights under these Terms</li>
                    <li>Except our affiliates, officers, and employees</li>
                </ul>
                <h4>16.6 Force Majeure</h4>
                <p>We are not liable for delays or failures due to:</p>
                <ul>
                    <li>Acts of God, natural disasters</li>
                    <li>War, terrorism, civil unrest</li>
                    <li>Government actions or regulations</li>
                    <li>Internet or power failures</li>
                    <li>Other events beyond our reasonable control</li>
                </ul>
                <h4>16.7 Relationship</h4>
                <p>These Terms do not create:</p>
                <ul>
                    <li>‚ùå Partnership or joint venture</li>
                    <li>‚ùå Employer-employee relationship</li>
                    <li>‚ùå Franchisor-franchisee relationship</li>
                    <li>‚ùå Agency relationship</li>
                </ul>
                <h4>16.8 Notices</h4>
                <p><strong>To You:</strong></p>
                <ul>
                    <li>Email (if provided)</li>
                    <li>In-app notification</li>
                    <li>Posting on website</li>
                </ul>
                <p><strong>To Us:</strong></p>
                <ul>
                    <li>Email: legal@legalmitra.com</li>
                    <li>Mail: [Physical Address]</li>
                </ul>
                <p><strong>Effective:</strong> 3 business days after sending</p>
                <h4>16.9 Interpretation</h4>
                <p>In case of ambiguity:</p>
                <ul>
                    <li>Headings are for convenience only</li>
                    <li>Examples are illustrative, not exhaustive</li>
                    <li>"Including" means "including but not limited to"</li>
                    <li>Singular includes plural and vice versa</li>
                </ul>
                <h4>16.10 Electronic Communications</h4>
                <p>You consent to receive communications from us electronically:</p>
                <ul>
                    <li>Email, in-app messages</li>
                    <li>Satisfies legal written communication requirements</li>
                    <li>You may withdraw consent by stopping use</li>
                </ul>
                <hr>
                <h3>17. Accessibility</h3>
                <p>We strive to make our service accessible to users with disabilities:</p>
                <ul>
                    <li>Following WCAG guidelines where possible</li>
                    <li>Providing alternative text for images</li>
                    <li>Keyboard navigation support</li>
                    <li>Screen reader compatibility</li>
                </ul>
                <p><strong>Feedback:</strong> If you encounter accessibility issues, contact:
                    accessibility@legalmitra.com</p>
                <hr>
                <h3>18. Export Control</h3>
                <p>If our service is subject to export controls:</p>
                <ul>
                    <li>You may not use service in violation of export laws</li>
                    <li>You may not export, re-export, or transfer the service</li>
                    <li>Compliance is your responsibility</li>
                </ul>
                <hr>
                <h3>19. Government Use</h3>
                <p>If you are a government entity:</p>
                <ul>
                    <li>Additional terms may apply</li>
                    <li>Contact us for government-specific agreements</li>
                    <li>Special pricing or licensing may be available</li>
                </ul>
                <hr>
                <h3>20. Contact Information</h3>
                <p>For questions about these Terms:</p>
                <p><strong>General Inquiries:</strong> Email: support@legalmitra.com Phone: [Contact Number]</p>
                <p><strong>Legal Matters:</strong> Email: legal@legalmitra.com</p>
                <p><strong>Terms Interpretation:</strong> Email: legal@legalmitra.com</p>
                <p><strong>Mailing Address:</strong> LegalMitra Flat No. 201, Sarvajit Heights Apartment Kembathalli
                    Main Road, Gottigere, Bengaluru 560083] Karnataka India</p>
                <hr>
                <h3>21. Feedback and Suggestions</h3>
                <p>We welcome your feedback:</p>
                <ul>
                    <li>Email: jayamurli1954@gmail.com</li>
                    <li>Use in-app feedback forms</li>
                    <li>Rate our service (if prompted)</li>
                </ul>
                <p><strong>Note:</strong> Feedback may be used to improve service without compensation.</p>
                <hr>
                <h3>22. Acknowledgment</h3>
                <p><strong>BY USING LEGALMITRA, YOU ACKNOWLEDGE THAT:</strong> 1. You have read and understood these
                    Terms 2. You agree to be bound by these Terms 3. You meet eligibility requirements 4. You will
                    comply with all applicable laws 5. You understand the limitations and disclaimers 6. You waive any
                    claims inconsistent with these Terms</p>
                <p><strong>IF YOU DO NOT AGREE, DO NOT USE THIS SERVICE.</strong></p>
                <hr>
                <p><strong>Effective Date:</strong> December 15, 2025 <strong>Last Updated:</strong> December 15, 2025
                    <strong>Version:</strong> 1.1
                </p>
                <p><strong>¬© 2025 LegalMitra. All Rights Reserved.</strong></p>
                <hr>
                <p>[END OF TERMS OF USE]</p>
            </div>
        </div>
    </div>



    <!-- About Modal -->
    <div id="about-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('about')">&times;</span>
            <h2>About LegalMitra</h2>
            <div>
                <h3>What is LegalMitra?</h3>
                <p>LegalMitra is an AI-powered legal assistant designed specifically for the Indian legal system. It
                    helps practicing advocates, legal professionals, and individuals navigate complex Indian laws,
                    regulations, and legal procedures with ease.</p>

                <h3>Key Features</h3>
                <ul>
                    <li><strong>Legal Research:</strong> Get comprehensive answers to legal questions about Indian laws,
                        regulations, and compliance requirements</li>
                    <li><strong>Document Drafting:</strong> Generate legal documents including notices, petitions,
                        replies, and legal opinions</li>
                    <li><strong>Case Law Search:</strong> Search and retrieve relevant case laws by topic, court, or
                        year</li>
                    <li><strong>Statute Search:</strong> Find and understand specific sections of Indian Acts and
                        regulations</li>
                </ul>

                <h3>Legal Knowledge Base</h3>
                <p>LegalMitra is built with comprehensive knowledge of:</p>
                <ul>
                    <li>150+ Indian Acts and regulations</li>
                    <li>15+ Industry-specific compliance requirements</li>
                    <li>25+ Regulatory bodies and their guidelines</li>
                    <li>Key Supreme Court and High Court precedents</li>
                </ul>

                <h3>AI Technology</h3>
                <p>LegalMitra leverages advanced AI models including:</p>
                <ul>
                    <li>Anthropic Claude (Claude Sonnet 4)</li>
                    <li>Google Gemini</li>
                    <li>Grok (xAI)</li>
                </ul>
                <p>These models are fine-tuned to understand Indian legal terminology, procedures, and context.</p>

                <h3>Privacy and Security</h3>
                <p>LegalMitra prioritizes your privacy. The application runs locally on your device, and your API keys
                    are stored securely in your local environment. We do not store or transmit your legal queries to our
                    servers.</p>

                <h3>For Advocates and Legal Professionals</h3>
                <p>LegalMitra is designed to assist legal professionals by:</p>
                <ul>
                    <li>Accelerating legal research and case preparation</li>
                    <li>Ensuring compliance with current laws and regulations</li>
                    <li>Providing quick access to relevant case laws and precedents</li>
                    <li>Drafting standardized legal documents efficiently</li>
                </ul>

                <h3>Disclaimer</h3>
                <p>LegalMitra is a tool to assist legal professionals and is not a substitute for professional legal
                    judgment. Always verify information and consult with qualified legal experts for critical matters.
                </p>

                <h3>Version</h3>
                <p>LegalMitra v1.0 - Powered by Advanced AI Technology</p>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div id="contact-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('contact')">&times;</span>
            <h2>Contact Us</h2>
            <div>
                <h3>Get in Touch</h3>
                <p>We'd love to hear from you! Whether you have questions, feedback, or need support, we're here to
                    help.</p>

                <h3>Support</h3>
                <p>For technical support, troubleshooting, or questions about using LegalMitra:</p>
                <ul>
                    <li>Check the documentation files in your LegalMitra folder</li>
                    <li>Review the README.md file for setup instructions</li>
                    <li>Check troubleshooting guides for common issues</li>
                </ul>

                <h3>Feedback and Suggestions</h3>
                <p>Your feedback helps us improve LegalMitra. If you have suggestions for:</p>
                <ul>
                    <li>New features or improvements</li>
                    <li>Additional legal acts or regulations to include</li>
                    <li>UI/UX enhancements</li>
                    <li>Bug reports or issues</li>
                </ul>
                <p>Please note that LegalMitra is currently a local application. For feedback or contributions, you can
                    modify the codebase directly or contact the development team if contact information is available.
                </p>

                <h3>Technical Information</h3>
                <p><strong>Application Type:</strong> Desktop Application (Local)</p>
                <p><strong>Backend:</strong> FastAPI (Python)</p>
                <p><strong>Frontend:</strong> HTML/JavaScript</p>
                <p><strong>AI Providers:</strong> Anthropic Claude, Google Gemini, Grok (xAI)</p>
                <p><strong>Default Port:</strong> 8888</p>

                <h3>Important Notes</h3>
                <ul>
                    <li>LegalMitra runs locally on your machine - no data is sent to external servers except to AI
                        service providers (via your API keys)</li>
                    <li>Keep your API keys secure and never share them publicly</li>
                    <li>For legal advice, always consult with qualified legal professionals</li>
                    <li>LegalMitra is a research and drafting tool, not a replacement for legal counsel</li>
                </ul>

                <h3>Documentation</h3>
                <p>For detailed information, please refer to:</p>
                <ul>
                    <li>README.md - Project overview and setup</li>
                    <li>HOW_TO_USE.md - Usage instructions</li>
                    <li>QUICK_START.txt - Quick setup guide</li>
                    <li>Various troubleshooting guides for specific issues</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="config.js?v=1.2.0"></script>
    <script>
        // Use configuration from config.js (defaults to port 8888)
        const API_BASE_URL = (typeof CONFIG !== 'undefined') ? CONFIG.API_BASE_URL : 'http://localhost:8888/api/v1';
        
        // Listen for service worker updates
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', (event) => {
                if (event.data && event.data.type === 'SW_UPDATED') {
                    console.log('Service worker updated, reloading page...');
                    window.location.reload();
                }
            });
        }

        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                // Fallback: activate tab by index
                const tabs = document.querySelectorAll('.tab');
                const tabMap = { 'research': 0, 'drafting': 1, 'case-search': 2, 'statute': 3 };
                if (tabMap[tabName] !== undefined) {
                    tabs[tabMap[tabName]]?.classList.add('active');
                }
            }

            // Reload recent queries if switching to research tab
            if (tabName === 'research') {
                initRecentQueries();
            }
        }

        function openModal(modalName) {
            const modal = document.getElementById(`${modalName}-modal`);
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }
        }

        function closeModal(modalName) {
            const modal = document.getElementById(`${modalName}-modal`);
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto'; // Restore scrolling
            }
        }

        // Close modal when clicking outside of it
        window.onclick = function (event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // Close modal with Escape key
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                        document.body.style.overflow = 'auto';
                    }
                });
            }
        });

        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = `
                <div class="response loading">
                    <div class="spinner"></div>
                    <p>Processing your request...</p>
                </div>
            `;
        }

        function showResponse(elementId, content, isError = false) {
            console.log('showResponse called:', { elementId, contentLength: content ? content.length : 0, isError });

            const element = document.getElementById(elementId);
            if (!element) {
                console.error('ERROR: Response element not found:', elementId);
                alert('Error: Response container not found: ' + elementId);
                return;
            }

            console.log('Element found:', element);

            const className = isError ? 'response error' : 'response success';
            // Escape HTML but preserve line breaks
            const escapedContent = String(content || '')
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;')
                .replace(/\n/g, '<br>');

            const html = `
                <div class="${className}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h3 style="margin: 0;">${isError ? '‚ö†Ô∏è Error' : '‚úÖ Response'}</h3>
                        ${!isError ? `<button onclick="downloadResponse('${elementId}')" style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 14px;" title="Download Response">üì• Download</button>` : ''}
                    </div>
                    <div class="response-content" data-original-content="${escapeHtml(content).replace(/"/g, '&quot;')}">${escapedContent}</div>
                </div>
            `;

            console.log('Setting innerHTML, length:', html.length);
            element.innerHTML = html;
            element.style.display = 'block'; // Ensure it's visible
            console.log('Response displayed in element:', element);

            // Scroll to response after a brief delay
            setTimeout(() => {
                element.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // Recent Queries Functions
        function saveRecentQuery(query) {
            if (!query || !query.trim()) return;

            let recentQueries = JSON.parse(localStorage.getItem('legalmitra_recent_queries') || '[]');

            // Remove if already exists (to avoid duplicates)
            recentQueries = recentQueries.filter(q => q.text !== query.trim());

            // Add to beginning
            recentQueries.unshift({
                text: query.trim(),
                timestamp: new Date().toISOString()
            });

            // Keep only last 20 queries
            recentQueries = recentQueries.slice(0, 20);

            localStorage.setItem('legalmitra_recent_queries', JSON.stringify(recentQueries));
            loadRecentQueries(); // Refresh the list
        }

        function loadRecentQueries() {
            try {
                const recentQueries = JSON.parse(localStorage.getItem('legalmitra_recent_queries') || '[]');
                const listContainer = document.getElementById('recent-queries-list');

                if (!listContainer) return; // Element might not exist yet

                // Filter out invalid entries and clean up data
                const validQueries = recentQueries.filter(q => q && (q.text || q.query)).map(q => ({
                    text: q.text || q.query || '',
                    timestamp: q.timestamp || new Date().toISOString()
                })).filter(q => q.text.trim().length > 0);

                // Update localStorage with cleaned data
                if (validQueries.length !== recentQueries.length) {
                    localStorage.setItem('legalmitra_recent_queries', JSON.stringify(validQueries));
                }

                if (validQueries.length === 0) {
                    listContainer.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No recent queries yet. Your queries will appear here.</p>';
                    return;
                }

                listContainer.innerHTML = validQueries.map((query, index) => {
                    const queryText = query.text || '';
                    const displayText = queryText.length > 100 ? queryText.substring(0, 100) + '...' : queryText;
                    const timestamp = query.timestamp ? formatTimestamp(new Date(query.timestamp)) : 'Unknown time';

                    return `
                        <div class="recent-query-item" style="padding: 12px; margin-bottom: 8px; background: white; border-radius: 6px; border-left: 3px solid #667eea; cursor: pointer; transition: all 0.2s;" 
                             onmouseover="this.style.background='#f0f0f0'; this.style.transform='translateX(3px)'" 
                             onmouseout="this.style.background='white'; this.style.transform='translateX(0)'"
                             onclick="useRecentQuery(${index})">
                            <div style="font-weight: 500; color: #333; margin-bottom: 4px;">${escapeHtml(displayText)}</div>
                            <div style="font-size: 0.85em; color: #999;">${timestamp}</div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading recent queries:', error);
                // Clear invalid localStorage data
                try {
                    localStorage.removeItem('legalmitra_recent_queries');
                } catch (e) {
                    console.error('Error clearing localStorage:', e);
                }
            }
        }

        function useRecentQuery(index) {
            try {
                const recentQueries = JSON.parse(localStorage.getItem('legalmitra_recent_queries') || '[]');
                const validQueries = recentQueries.filter(q => q && (q.text || q.query));

                if (index >= 0 && index < validQueries.length) {
                    const queryText = validQueries[index].text || validQueries[index].query || '';
                    const queryInput = document.getElementById('research-query');
                    if (queryInput) {
                        queryInput.value = queryText;
                        queryInput.focus();
                        queryInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            } catch (error) {
                console.error('Error using recent query:', error);
            }
        }

        function toggleRecentQueries() {
            const listContainer = document.getElementById('recent-queries-list');
            const toggleIcon = document.getElementById('toggle-icon');

            if (listContainer && toggleIcon) {
                if (listContainer.style.display === 'none' || !listContainer.style.display) {
                    listContainer.style.display = 'block';
                    toggleIcon.textContent = '‚ñ≤';
                } else {
                    listContainer.style.display = 'none';
                    toggleIcon.textContent = '‚ñº';
                }
            }
        }

        function formatTimestamp(date) {
            const now = new Date();
            const diff = now - date;
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (seconds < 60) return 'Just now';
            if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            if (days < 7) return `${days} day${days > 1 ? 's' : ''} ago`;

            // Format as date if older than a week
            return date.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }


        // Load Major Cases and Legal News
        async function loadMajorCases(forceWeb = false) {
            const container = document.getElementById('major-cases-container');
            if (!container) return;

            try {
                // Use relative URLs in production, absolute in development
                const url = forceWeb
                    ? `${API_BASE_URL}/major-cases?force_web=true`
                    : `${API_BASE_URL}/major-cases`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch major cases');

                const data = await response.json();

                if (data.cases && data.cases.length > 0) {
                    container.innerHTML = '<ul>' + data.cases.map((caseItem, index) => {
                        const courtYear = caseItem.year ? `${caseItem.court} (${caseItem.year})` : caseItem.court;
                        const queryEscaped = escapeHtml(caseItem.query);
                        return `
                            <li class="clickable-case-item" data-query="${queryEscaped.replace(/"/g, '&quot;')}" style="cursor: pointer;">
                                <div class="case-item-title">${escapeHtml(caseItem.title)}</div>
                                <div class="case-item-court">${escapeHtml(courtYear)}</div>
                                <div class="case-item-summary">${escapeHtml(caseItem.summary)}</div>
                            </li>
                        `;
                    }).join('') + '</ul>';
                    // Attach event listeners to all case items
                    container.querySelectorAll('.clickable-case-item').forEach(item => {
                        item.addEventListener('click', function () {
                            const query = this.getAttribute('data-query');
                            loadCaseDetails(query);
                        });
                    });
                } else {
                    container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No recent cases available.</p>';
                }
            } catch (error) {
                console.error('Error loading major cases:', error);
                console.error('Error details:', error.message, error.stack);
                // Show default cases as fallback
                container.innerHTML = '<ul>' + [
                    { title: 'Recent GST Case', court: 'Supreme Court of India', year: 2025, summary: 'Latest important judgment related to GST law and taxation.', query: 'What are the latest important GST judgments from Supreme Court?' },
                    { title: 'Corporate Law Decision', court: 'Supreme Court of India', year: 2025, summary: 'Recent significant decision affecting corporate governance and compliance.', query: 'What are the latest corporate law judgments?' },
                    { title: 'Constitutional Matter', court: 'Supreme Court of India', year: 2025, summary: 'Recent constitutional interpretation or fundamental rights case.', query: 'What are the latest constitutional law judgments?' }
                ].map((caseItem) => {
                    const courtYear = caseItem.year ? `${caseItem.court} (${caseItem.year})` : caseItem.court;
                    const queryEscaped = escapeHtml(caseItem.query);
                    return `
                        <li class="clickable-case-item" data-query="${queryEscaped.replace(/"/g, '&quot;')}" style="cursor: pointer;">
                            <div class="case-item-title">${escapeHtml(caseItem.title)}</div>
                            <div class="case-item-court">${escapeHtml(courtYear)}</div>
                            <div class="case-item-summary">${escapeHtml(caseItem.summary)}</div>
                        </li>
                    `;
                }).join('') + '</ul>';
                container.querySelectorAll('.clickable-case-item').forEach(item => {
                    item.addEventListener('click', function () {
                        const query = this.getAttribute('data-query');
                        loadCaseDetails(query);
                    });
                });
            }
        }

        async function loadLegalNews(forceWeb = false) {
            const container = document.getElementById('legal-news-container');
            if (!container) return;

            try {
                // Use relative URLs in production, absolute in development
                const url = forceWeb
                    ? `${API_BASE_URL}/legal-news?force_web=true`
                    : `${API_BASE_URL}/legal-news`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch legal news');

                const data = await response.json();

                if (data.news && data.news.length > 0) {
                    container.innerHTML = '<ul>' + data.news.map((newsItem, index) => {
                        const meta = [];
                        if (newsItem.source) meta.push(newsItem.source);
                        if (newsItem.date) meta.push(newsItem.date);
                        const metaText = meta.length > 0 ? meta.join(' ‚Ä¢ ') : '';
                        const queryEscaped = escapeHtml(newsItem.query);

                        return `
                            <li class="clickable-news-item" data-query="${queryEscaped.replace(/"/g, '&quot;')}" style="cursor: pointer;">
                                <div class="news-item-title">${escapeHtml(newsItem.title)}</div>
                                ${metaText ? `<div class="news-item-meta">${escapeHtml(metaText)}</div>` : ''}
                                <div class="news-item-summary">${escapeHtml(newsItem.summary)}</div>
                            </li>
                        `;
                    }).join('') + '</ul>';
                    // Attach event listeners to all news items
                    container.querySelectorAll('.clickable-news-item').forEach(item => {
                        item.addEventListener('click', function () {
                            const query = this.getAttribute('data-query');
                            loadNewsDetails(query);
                        });
                    });
                } else {
                    container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No recent news available.</p>';
                }
            } catch (error) {
                console.error('Error loading legal news:', error);
                console.error('Error details:', error.message, error.stack);
                // Show default news as fallback
                container.innerHTML = '<ul>' + [
                    { title: 'GST 2.0 Reforms Update', source: 'CBIC', date: '2025', summary: 'Latest updates on GST 2.0 reforms and rate structure changes.', query: 'Tell me about GST 2.0 reforms and latest amendments' },
                    { title: 'Finance Act Updates', source: 'Ministry of Finance', date: '2025', summary: 'Recent amendments introduced through Finance Act affecting tax laws.', query: 'What are the latest Finance Act amendments?' },
                    { title: 'Legal Reforms News', source: 'Legal Updates', date: '2025', summary: 'Recent legal reforms and regulatory changes affecting businesses.', query: 'What are the latest legal reforms in India?' }
                ].map((newsItem) => {
                    const meta = [];
                    if (newsItem.source) meta.push(newsItem.source);
                    if (newsItem.date) meta.push(newsItem.date);
                    const metaText = meta.length > 0 ? meta.join(' ‚Ä¢ ') : '';
                    const queryEscaped = escapeHtml(newsItem.query);
                    return `
                        <li class="clickable-news-item" data-query="${queryEscaped.replace(/"/g, '&quot;')}" style="cursor: pointer;">
                            <div class="news-item-title">${escapeHtml(newsItem.title)}</div>
                            ${metaText ? `<div class="news-item-meta">${escapeHtml(metaText)}</div>` : ''}
                            <div class="news-item-summary">${escapeHtml(newsItem.summary)}</div>
                        </li>
                    `;
                }).join('') + '</ul>';
                container.querySelectorAll('.clickable-news-item').forEach(item => {
                    item.addEventListener('click', function () {
                        const query = this.getAttribute('data-query');
                        loadNewsDetails(query);
                    });
                });
            }
        }



        // Helper function for HTML escaping - Moved to top scope
        function escapeHtml(text) {
            if (!text) return text;
            return String(text)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function closeArticleModal() {
            const modal = document.getElementById('article-modal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        function formatArticleContent(content) {
            // Convert plain text to formatted HTML
            // Preserve line breaks and structure
            let html = escapeHtml(content);

            // Convert double line breaks to paragraphs
            html = html.replace(/\n\n+/g, '</p><p>');
            html = '<p>' + html + '</p>';

            // Convert single line breaks to <br>
            html = html.replace(/\n/g, '<br>');

            // Format headings (lines that are all caps or end with :)
            html = html.replace(/<p>(<strong>)?([A-Z][^:]+):(<\/strong>)?<\/p>/g, '<h3>$2</h3>');

            // Format bold text patterns
            html = html.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');

            return html;
        }

        // Refresh interval for cases and news (30 minutes = 1800000 milliseconds)
        let casesNewsRefreshInterval = null;
        const REFRESH_INTERVAL_MS = 30 * 60 * 1000; // 30 minutes

        // Initialize Recent Major Judgments
        async function loadMajorCases(forceWeb = false) {
            const container = document.getElementById('major-cases-container');
            if (!container) return;

            if (forceWeb || !container.children.length) {
                container.innerHTML = '<div class="loading-box"><div class="spinner" style="width: 30px; height: 30px; border-width: 2px; margin: 0 auto 10px;"></div>Loading recent judgments...</div>';
            }

            try {
                const url = forceWeb ? `${API_BASE_URL}/major-cases?force_web=true` : `${API_BASE_URL}/major-cases`;

                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch cases');

                const data = await response.json();

                if (data.cases && data.cases.length > 0) {
                    container.innerHTML = '<ul>' + data.cases.map(item => `
                        <li onclick="openArticleModal(this)"
                            data-title="${escapeHtml(item.title)}"
                            data-court="${escapeHtml(item.court || 'Supreme Court')}"
                            data-year="${escapeHtml(item.year || '')}"
                            data-summary="${escapeHtml(item.summary)}"
                            data-query="${escapeHtml(item.query || item.title)}"
                            data-url="${item.url}"
                            data-type="case">
                            <div class="case-item-title">${item.title}</div>
                            <div class="case-item-court">${item.court || 'Supreme Court of India'}</div>
                            <div class="case-item-summary">${item.summary}</div>
                        </li>
                    `).join('') + '</ul>';
                } else {
                    container.innerHTML = '<div class="loading-box">No recent judgments found.</div>';
                }
            } catch (error) {
                console.error('Error loading major cases:', error);

                // Fallback content if API fails - NO EXTERNAL LINKS
                container.innerHTML = `
                <ul>
                    <li onclick="alert('Connection Error: ' + '${escapeHtml(error.message)}'.replace(/'/g, &quot;\\'&quot;))">
                        <div class="case-item-title">System Offline / No Data</div>
                        <div class="case-item-court">System Message</div>
                        <div class="case-item-summary">Error: ${escapeHtml(error.message)}<br>Please check your connection and try again.</div>
                    </li>
                </ul>`;
            }
        }

        // Initialize Latest Legal News
        async function loadLegalNews(forceWeb = false) {
            const container = document.getElementById('legal-news-container');
            if (!container) return;

            if (forceWeb || !container.children.length) {
                container.innerHTML = '<div class="loading-box"><div class="spinner" style="width: 30px; height: 30px; border-width: 2px; margin: 0 auto 10px;"></div>Loading legal news...</div>';
            }

            try {
                const url = forceWeb ? `${API_BASE_URL}/legal-news?force_web=true` : `${API_BASE_URL}/legal-news`;

                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch news');

                const data = await response.json();

                if (data.news && data.news.length > 0) {
                    container.innerHTML = '<ul>' + data.news.map(item => `
                        <li onclick="openArticleModal(this)"
                            data-title="${escapeHtml(item.title)}"
                            data-source="${escapeHtml(item.source || 'Legal News')}"
                            data-date="${escapeHtml(item.date || '')}"
                            data-summary="${escapeHtml(item.summary)}"
                            data-query="${escapeHtml(item.query || item.title)}"
                            data-url="${item.url}"
                            data-type="news">
                            <div class="news-item-title">${item.title}</div>
                            <div class="news-item-meta">${item.source} ‚Ä¢ ${item.date}</div>
                            <div class="news-item-summary">${item.summary}</div>
                        </li>
                    `).join('') + '</ul>';
                } else {
                    container.innerHTML = '<div class="loading-box">No legal news found.</div>';
                }
            } catch (error) {
                console.error('Error loading legal news:', error);
                container.innerHTML = '<div class="loading-box">Unable to load news at this time.</div>';
            }
        }

        // Modal Functions
        async function openArticleModal(element) {
            const data = element.dataset;
            document.getElementById('article-title').textContent = data.title;

            const source = data.type === 'case' ? data.court : data.source;
            const date = data.type === 'case' ? (data.year || '') : data.date;

            document.getElementById('article-source').textContent = source || 'Legal Update';
            document.getElementById('article-date').textContent = date || '';

            // Show summary immediately
            const bodyEl = document.getElementById('article-body');
            bodyEl.innerHTML = `<p>${escapeHtml(data.summary)}</p><hr><p class="article-loading" style="text-align:center;color:#666;"><em>ü§ñ Analyzing details with AI...</em></p>`;

            // Set external link
            const linkBtn = document.getElementById('article-link');
            if (data.url && data.url !== 'undefined') {
                linkBtn.href = data.url;
                linkBtn.style.display = 'inline-block';
            } else {
                linkBtn.style.display = 'none';
            }

            document.getElementById('article-modal').style.display = 'block';

            // Fetch full details if query exists
            if (data.query) {
                try {
                    const response = await fetch(`${API_BASE_URL}/legal-research`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            query: data.query,
                            query_type: 'research'
                        })
                    });

                    if (response.ok) {
                        const resData = await response.json();
                        if (resData.response) {
                            bodyEl.innerHTML = `<p>${formatArticleContent(resData.response)}</p>`;
                        }
                    } else {
                        bodyEl.innerHTML = `<p>${escapeHtml(data.summary)}</p><hr><p style="color:#e67e22;text-align:center;"><em>(AI Analysis unavailable, showing summary only)</em></p>`;
                    }
                } catch (e) {
                    console.error(e);
                    bodyEl.innerHTML = `<p>${escapeHtml(data.summary)}</p><hr><p style="color:#e67e22;text-align:center;"><em>(AI Analysis request failed, showing summary only)</em></p>`;
                }
            }
        }

        function closeArticleModal() {
            document.getElementById('article-modal').style.display = 'none';
        }



        // Manual refresh function for cases and news
        async function refreshCasesAndNews() {
            console.log('üîÑ Refresh button clicked - refreshing cases and news...');

            // Disable refresh buttons temporarily
            const refreshButtons = document.querySelectorAll('.refresh-btn');
            const originalTexts = [];
            refreshButtons.forEach((btn, index) => {
                originalTexts[index] = btn.textContent;
                btn.disabled = true;
                btn.style.opacity = '0.6';
                btn.style.cursor = 'not-allowed';
                btn.textContent = 'üîÑ Refreshing...';
            });

            try {
                // Clear existing content to show loading state
                const casesContainer = document.getElementById('major-cases-container');
                const newsContainer = document.getElementById('legal-news-container');

                if (casesContainer) {
                    casesContainer.innerHTML = '<div class="loading-box"><div class="spinner" style="width: 30px; height: 30px; border-width: 2px; margin: 0 auto 10px;"></div>Refreshing cases...</div>';
                }
                if (newsContainer) {
                    newsContainer.innerHTML = '<div class="loading-box"><div class="spinner" style="width: 30px; height: 30px; border-width: 2px; margin: 0 auto 10px;"></div>Refreshing news...</div>';
                }

                // Reload both cases and news with force_web=true to fetch from web
                await Promise.all([
                    loadMajorCases(true),  // force_web=true
                    loadLegalNews(true)    // force_web=true
                ]);

                console.log('‚úÖ Refresh complete');
            } catch (error) {
                console.error('‚ùå Error refreshing cases and news:', error);
                alert('Error refreshing content. Please check the console for details.');
            } finally {
                // Re-enable refresh buttons after a short delay
                setTimeout(() => {
                    refreshButtons.forEach((btn, index) => {
                        btn.disabled = false;
                        btn.style.opacity = '1';
                        btn.style.cursor = 'pointer';
                        btn.textContent = originalTexts[index] || 'üîÑ Refresh';
                    });
                }, 500);
            }
        }

        // Initialize cases and news on page load
        function initCasesAndNews() {
            // Wait for DOM to be ready
            setTimeout(() => {
                loadMajorCases();
                loadLegalNews();
            }, 200);

            // Set up automatic refresh every 30 minutes
            if (casesNewsRefreshInterval) {
                clearInterval(casesNewsRefreshInterval);
            }
            casesNewsRefreshInterval = setInterval(() => {
                console.log('Auto-refreshing cases and news (30-minute interval)...');
                refreshCasesAndNews();
            }, REFRESH_INTERVAL_MS);

            console.log('Auto-refresh enabled: Cases and news will refresh every 30 minutes');
        }

        // Load recent queries when page loads and when tab is switched
        function initRecentQueries() {
            // Wait a bit to ensure DOM is ready
            setTimeout(() => {
                loadRecentQueries();
            }, 100);
        }

        // Load template count dynamically (for marketplace - uses v2 API)
        async function loadTemplateCount() {
            try {
                const url = `${API_BASE_URL}/v2/templates`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    console.error('Failed to fetch template count:', response.status, response.statusText);
                    return; // Silently fail, keep default button text
                }
                
                // Check if response is JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    console.warn('Template count response is not JSON:', contentType);
                    return;
                }
                
                const data = await response.json();
                const count = data.total || 0;
                const button = document.getElementById('template-marketplace-btn');
                if (button) {
                    // Update button text with count
                    button.innerHTML = `üõí Template Marketplace (${count})`;
                }
            } catch (error) {
                console.log('Could not load template count:', error.message);
                // If API fails, silently keep default button text
            }
        }

        window.addEventListener('DOMContentLoaded', function () {
            initRecentQueries();
            initCasesAndNews();
            loadTemplateCount();

            // Close article modal when clicking outside
            const articleModal = document.getElementById('article-modal');
            if (articleModal) {
                articleModal.addEventListener('click', function (event) {
                    if (event.target === articleModal) {
                        closeArticleModal();
                    }
                });
            }

            // Close article modal with Escape key
            document.addEventListener('keydown', function (event) {
                if (event.key === 'Escape') {
                    closeArticleModal();
                }
            });
        });

        // File handling variables
        let selectedFile = null;

        // Handle File Select
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/png', 'image/jpeg', 'image/jpg', 'text/plain'];
            if (!allowedTypes.includes(file.type)) {
                alert('Please select a PDF, DOC, DOCX, PNG, JPEG, or TXT file');
                event.target.value = '';
                return;
            }

            if (file.size > 10 * 1024 * 1024) { // 10MB limit
                alert('File size must be less than 10MB');
                event.target.value = '';
                return;
            }

            selectedFile = file;
            showFilePreview(file);
        }

        // Show File Preview
        function showFilePreview(file) {
            const container = document.getElementById('file-preview-container');
            if (!container) return;

            const fileExtension = file.name.split('.').pop().toUpperCase();
            const fileSize = formatFileSize(file.size);

            container.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üìÑ</span>
                        <div>
                            <div style="font-weight: bold;">${escapeHtml(file.name)}</div>
                            <div style="font-size: 0.9em; color: #666;">${fileExtension} ‚Ä¢ ${fileSize}</div>
                        </div>
                    </div>
                    <button onclick="removeFile()" style="background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">‚úï Remove</button>
                </div>
            `;
            container.style.display = 'block';
        }

        // Remove File
        function removeFile() {
            selectedFile = null;
            const container = document.getElementById('file-preview-container');
            const fileInput = document.getElementById('research-file-input');
            if (container) container.style.display = 'none';
            if (fileInput) fileInput.value = '';
        }

        // Format File Size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // Download Response
        function downloadResponse(elementId) {
            try {
                const element = document.getElementById(elementId);
                if (!element) {
                    alert('Response not found');
                    return;
                }

                // Get the original content from data attribute or extract from DOM
                const contentDiv = element.querySelector('.response-content');
                let content = '';

                if (contentDiv && contentDiv.getAttribute('data-original-content')) {
                    // Decode HTML entities from data attribute
                    const textarea = document.createElement('textarea');
                    textarea.innerHTML = contentDiv.getAttribute('data-original-content');
                    content = textarea.value;
                } else {
                    // Fallback: extract text from DOM (will lose formatting)
                    content = contentDiv ? contentDiv.textContent || contentDiv.innerText : '';
                }

                if (!content) {
                    alert('No content to download');
                    return;
                }

                // Create a blob with the content
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = window.URL.createObjectURL(blob);

                // Create download link
                const a = document.createElement('a');
                a.href = url;
                a.download = `LegalMitra_Response_${new Date().toISOString().slice(0, 10)}_${Date.now()}.txt`;
                document.body.appendChild(a);
                a.click();

                // Cleanup
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error downloading response:', error);
                alert('Error downloading response. Please try copying the text manually.');
            }
        }

        async function performResearch() {
            const queryInput = document.getElementById('research-query');
            if (!queryInput) {
                alert('Error: Cannot find query input field. Please refresh the page.');
                return;
            }

            let query = queryInput.value;
            const queryType = document.getElementById('query-type').value;

            // If file is selected, use document review endpoint
            if (selectedFile) {
                await performDocumentReview(query);
                return;
            }

            if (!query || !query.trim()) {
                alert('Please enter a legal question');
                return;
            }

            const responseDiv = document.getElementById('research-response');
            if (!responseDiv) {
                alert('Error: Response container not found. Please refresh the page.');
                return;
            }

            // Save to recent queries
            saveRecentQuery(query);

            // Clear any previous response
            responseDiv.innerHTML = '';
            responseDiv.style.display = 'block'; // Ensure it's visible

            showLoading('research-response');

            try {
                const apiUrl = `${API_BASE_URL}/legal-research`;

                // Add timeout (180 seconds for AI responses - complex legal queries may take longer)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => {
                    controller.abort();
                }, 180000);

                const requestBody = {
                    query: query,
                    query_type: queryType
                };

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                let data;
                let responseText = '';
                try {
                    responseText = await response.text();
                    // Check if response is empty
                    if (!responseText || responseText.trim().length === 0) {
                        throw new Error('Server returned empty response');
                    }
                    // Check if response looks like HTML (error page)
                    if (responseText.trim().startsWith('<!DOCTYPE') || responseText.trim().startsWith('<html')) {
                        throw new Error('Server returned HTML instead of JSON. The API endpoint may not exist.');
                    }
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    console.error('Response status:', response.status);
                    console.error('Response text (first 500 chars):', responseText.substring(0, 500));
                    throw new Error('Server returned invalid response. Please check the API endpoint and try again.');
                }

                if (response.ok) {
                    if (data && data.response) {
                        showResponse('research-response', data.response);
                        // Clear selected file after successful response
                        removeFile();
                    } else {
                        const errorMsg = 'Received invalid response from server. Please try again.';
                        showResponse('research-response', errorMsg, true);
                    }
                } else {
                    const errorMsg = data?.detail || data?.error || data?.message || `Server error (${response.status})`;
                    showResponse('research-response', `Error ${response.status}: ${errorMsg}`, true);
                }
            } catch (error) {
                console.error('Request error:', error);

                if (error.name === 'AbortError') {
                    showResponse('research-response', 'Request timed out after 3 minutes. Complex AI responses can take time. Please try a simpler query or try again.', true);
                } else if (error.message.includes('fetch') || error.message.includes('Failed to fetch') || error.name === 'TypeError') {
                    const errorMsg = `Connection error: Cannot connect to server.\n\nPlease check:\n1. Backend server is running\n2. No firewall blocking the connection\n3. CORS is enabled\n\nError: ${error.message}`;
                    alert(errorMsg);
                    showResponse('research-response', errorMsg, true);
                } else {
                    const errorMsg = `Error: ${error.message}\n\nPlease check your connection and try again.`;
                    alert(errorMsg);
                    showResponse('research-response', errorMsg, true);
                }
            }

            console.log('=== performResearch() COMPLETED ===');
        }

        // Perform Document Review with File Upload
        async function performDocumentReview(query = '') {
            if (!selectedFile) {
                alert('No file selected');
                return;
            }

            const responseDiv = document.getElementById('research-response');
            if (!responseDiv) {
                alert('Error: Response container not found. Please refresh the page.');
                return;
            }

            // Save to recent queries
            if (query) {
                saveRecentQuery(query);
            }

            // Clear any previous response
            responseDiv.innerHTML = '';
            responseDiv.style.display = 'block';

            showLoading('research-response');

            try {
                const apiUrl = `${API_BASE_URL}/review-document`;

                // Add timeout (180 seconds for document processing)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => {
                    controller.abort();
                }, 180000);

                // Create FormData for file upload
                const formData = new FormData();
                formData.append('file', selectedFile);
                if (query && query.trim()) {
                    formData.append('query', query);
                }

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    body: formData,
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                let data;
                let responseText = '';
                try {
                    responseText = await response.text();
                    // Check if response is empty
                    if (!responseText || responseText.trim().length === 0) {
                        throw new Error('Server returned empty response');
                    }
                    // Check if response looks like HTML (error page)
                    if (responseText.trim().startsWith('<!DOCTYPE') || responseText.trim().startsWith('<html')) {
                        throw new Error('Server returned HTML instead of JSON. The API endpoint may not exist.');
                    }
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    console.error('Response status:', response.status);
                    console.error('Response text (first 500 chars):', responseText.substring(0, 500));
                    throw new Error('Server returned invalid response. Please check the API endpoint and try again.');
                }

                if (response.ok) {
                    if (data && data.analysis) {
                        showResponse('research-response', data.analysis);
                        // Clear selected file after successful response
                        removeFile();
                    } else {
                        const errorMsg = 'Received invalid response from server. Please try again.';
                        showResponse('research-response', errorMsg, true);
                    }
                } else {
                    const errorMsg = data?.detail || data?.error || data?.message || `Server error (${response.status})`;
                    showResponse('research-response', `Error ${response.status}: ${errorMsg}`, true);
                }
            } catch (error) {
                console.error('Document review error:', error);

                if (error.name === 'AbortError') {
                    showResponse('research-response', 'Request timed out after 3 minutes. Document processing can take time. Please try again.', true);
                } else if (error.message.includes('fetch') || error.message.includes('Failed to fetch') || error.name === 'TypeError') {
                    const errorMsg = `Connection error: Cannot connect to server.\n\nPlease check:\n1. Backend server is running\n2. No firewall blocking the connection\n3. CORS is enabled\n\nError: ${error.message}`;
                    alert(errorMsg);
                    showResponse('research-response', errorMsg, true);
                } else {
                    const errorMsg = `Error: ${error.message}\n\nPlease check your connection and try again.`;
                    alert(errorMsg);
                    showResponse('research-response', errorMsg, true);
                }
            }
        }

        async function draftDocument() {
            const docType = document.getElementById('doc-type').value;
            const facts = document.getElementById('facts').value;
            const partiesText = document.getElementById('parties').value;
            const groundsText = document.getElementById('grounds').value;
            const prayer = document.getElementById('prayer').value;

            if (!facts.trim() || !partiesText.trim() || !groundsText.trim() || !prayer.trim()) {
                alert('Please fill all required fields');
                return;
            }

            let parties;
            try {
                parties = JSON.parse(partiesText);
            } catch (e) {
                alert('Invalid JSON format for parties. Use format: {"sender": "ABC", "recipient": "XYZ"}');
                return;
            }

            const grounds = groundsText.split('\n').filter(g => g.trim());

            showLoading('drafting-response');

            try {
                // Add timeout (180 seconds for document drafting)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 180000);

                const response = await fetch(`${API_BASE_URL}/draft-document`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        document_type: docType,
                        facts: facts,
                        parties: parties,
                        legal_grounds: grounds,
                        prayer: prayer
                    }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                const data = await response.json();

                if (response.ok) {
                    showResponse('drafting-response', data.drafted_document);
                } else {
                    showResponse('drafting-response', data.detail || 'An error occurred', true);
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    showResponse('drafting-response', 'Request timed out after 3 minutes. Document drafting can take time for complex documents. Please try again.', true);
                } else {
                    showResponse('drafting-response', `Connection error: ${error.message}\n\nPlease check your connection and try again.`, true);
                }
            }
        }

        async function searchCases() {
            const query = document.getElementById('case-query').value;
            const court = document.getElementById('court').value;
            const year = document.getElementById('year').value;

            if (!query.trim()) {
                alert('Please enter a search query');
                return;
            }

            showLoading('case-response');

            try {
                // Add timeout (120 seconds for case search)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 120000);

                const body = { query: query };
                if (court) body.court = court;
                if (year) body.year = parseInt(year);

                const response = await fetch(`${API_BASE_URL}/search-cases`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                const data = await response.json();

                if (response.ok) {
                    const casesText = data.cases.map((c, i) =>
                        `Case ${i + 1}:\n${c.content || JSON.stringify(c)}`
                    ).join('\n\n---\n\n');
                    showResponse('case-response', casesText);
                } else {
                    showResponse('case-response', data.detail || 'An error occurred', true);
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    showResponse('case-response', 'Request timed out after 2 minutes. Please try a simpler search query or try again.', true);
                } else {
                    showResponse('case-response', `Connection error: ${error.message}\n\nPlease check your connection and try again.`, true);
                }
            }
        }

        async function searchStatute() {
            const actName = document.getElementById('act-name').value;
            const section = document.getElementById('section').value;

            if (!actName.trim()) {
                alert('Please enter an act name');
                return;
            }

            showLoading('statute-response');

            try {
                // Add timeout (120 seconds for statute search)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 120000);

                const body = { act_name: actName };
                if (section) body.section = section;

                const response = await fetch(`${API_BASE_URL}/search-statute`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);
                const data = await response.json();

                if (response.ok) {
                    showResponse('statute-response', data.content || data.explanation);
                } else {
                    showResponse('statute-response', data.detail || 'An error occurred', true);
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    showResponse('statute-response', 'Request timed out after 2 minutes. Please try again.', true);
                } else {
                    showResponse('statute-response', `Connection error: ${error.message}\n\nPlease check your connection and try again.`, true);
                }
            }
        }
    </script>
    <!-- Article Viewer Modal -->
    <div id="article-modal" class="article-modal">
        <div class="article-modal-content">
            <div class="article-modal-header">
                <h2 id="article-title" class="article-modal-title">Article Title</h2>
                <span class="article-close" onclick="closeArticleModal()">&times;</span>
            </div>
            <div class="article-meta"
                style="margin-bottom: 20px; color: #666; font-size: 0.9em; display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                <span id="article-source" style="font-weight: bold; color: #667eea;">Source</span>
                <span id="article-date">Date</span>
            </div>
            <div id="article-body" class="article-body" style="white-space: pre-wrap;">
                <!-- Content will be injected here -->
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <a id="article-link" href="#" target="_blank" class="article-back-btn"
                    style="text-decoration: none; display: inline-block;">Read Full Article on Source Website</a>
                <p style="font-size: 0.8em; color: #999; margin-top: 10px;">(External Link - Opens in new tab)</p>
            </div>
        </div>
    </div>

    <!-- PWA Support -->
    <script src="pwa.js"></script>

</body>

</html>